var current_ua_list={};function updateBadge(){chrome.tabs.getSelected(null,function(c){var a="";var b=getSpoofValues(c.url);if(b&&b.badge&&b.badge!=""){a=b.badge}chrome.browserAction.setBadgeText({tabId:c.tabId,text:a})})}chrome.tabs.onSelectionChanged.addListener(function(a,b){updateBadge()});chrome.tabs.onUpdated.addListener(function(b,a,c){updateBadge()});chrome.extension.onRequest.addListener(function(c,b,a){if(c.action=="blacklist"){a(getSpoofValues(b.tab.url))}else{if(c.action=="hotlist_index"){a({ua_index:getHotlistIndex()})}else{if(c.action=="add_ua"){return(addCustomUAOption(c.name,c.user_agent,c.append_to_default_ua,c.indicator)?a({result:"success"}):a({result:"failure"}))}else{if(c.action=="delete_ua"){return(deleteUAOption(c.name,false)?a({result:"success"}):a({result:"failure"}))}else{if(c.action=="delete_base_ua"){return(deleteUAOption(c.name,true)?a({result:"success"}):a({result:"failure"}))}else{if(c.action=="set"){setHotlist(b.tab,c.user_agent_index);updateBadge();chrome.tabs.getSelected(null,function(d){if(d){chrome.tabs.reload(d.id,{bypassCache:true},function(){});chrome.tabs.update(d.id,{selected:true})}})}else{if(c.action=="options"){a({options:JSON.stringify(getOptions())})}else{if(c.action=="presets"){a({options:JSON.stringify(getPresets())})}else{if(c.action=="update"){updateListeners();a({})}else{if(c.action=="add_preset"){if(c.domain){addOption(c.domain,c.option_index);a({})}else{chrome.tabs.getSelected(null,function(d){if(d){addOption(findHostname(d.url),getHotlistIndex());chrome.tabs.update(d.id,{selected:true});a({})}})}}else{if(c.action=="clear_presets"){clearPresets()}else{if(c.action=="badge"){updateBadge()}else{if(c.action=="show_permanent_option"){chrome.tabs.getSelected(null,function(d){if(d){var e=getSpoofValuesForUrl(d.url);if(getHotlistIndex()>0&&(!e||!e.ua_string||e.ua_string=="")){a({show:true})}else{a({})}}})}else{console.log("Got an invalid request:"+c.action);a({})}}}}}}}}}}}}}return false});function replaceHeader(a,e){if(!a||!a.ua_string){return e}var d=[];for(var c=0;c<e.length;c++){if(e[c].name!="User-Agent"){d.push(e[c])}else{var b=e[c].value;if(a.ua_string!=""){b=(a.append_to_default_ua?b+" "+a.ua_string:a.ua_string)}d.push({name:"User-Agent",value:b})}}return{requestHeaders:d}}var listener=null;function updateListeners(){if(!listener){listener=function(a){if(a&&a.url&&a.requestHeaders&&a.requestHeaders.length>0){return replaceHeader(getSpoofValues(a.url),a.requestHeaders)}return{requestHeaders:a.requestHeaders}}}chrome.webRequest.onBeforeSendHeaders.addListener(listener,{urls:["http://*/*","https://*/*"]},["requestHeaders","blocking"])}updateListeners();