var preset_options=[];$(window).load(function(){restoreOptions();$("#menu_ua").click(function(){menuItemChange($("#custom_ua_table"),$(this))});$("#menu_spoof").click(function(){menuItemChange($("#permanent_spoof_table"),$(this))});$("#menu_other").click(function(){menuItemChange($("#other_settings_table"),$(this))});$("#menu_about").click(function(){menuItemChange($("#about_table"),$(this))});$("#menu_import").click(function(){menuItemChange($("#import_table"),$(this))});$("#builtin").change(function(){saveUseBuiltInListCheckbox()});$("#permanent_override").change(function(){savePermanentOverrideCheckbox()});$("#resetter").click(function(){resetHardcodedUserAgents()});menuItemChange($(".menu_controlled:first"),$(".menuitem:first"))});function saveUseBuiltInListCheckbox(){setShouldUsePresets($("#builtin").prop("checked"));if(shouldUsePresets()){setStatus("Now using built-in list.")}else{setStatus("No longer using built-in list.")}}function refreshBuiltInListCheckbox(){$("#builtin").prop("checked",shouldUsePresets())}function savePermanentOverrideCheckbox(){setPermanentSpoofOverride($("#permanent_override").prop("checked"));setStatus((getPermanentSpoofOverride()?"Permanent spoofs now always override fast-switch.":"Permanent spoofs now do not override the fast-switch."))}function refreshPermanentOverrideCheckbox(){$("#permanent_override").prop("checked",getPermanentSpoofOverride())}function setList(a){setSpoofList(a);chrome.extension.sendRequest({action:"update"},function(b){})}function getList(){var a=getSpoofList();chrome.extension.sendRequest({action:"update"},function(b){});if(!a||typeof a=="undefined"){a=new Array()}return a}function resetHardcodedUserAgents(){getBaseOptionsList(true);restoreOptions();menuItemChange($(".menu_controlled:first"),$(".menuitem:first"))}function guessGroup(){if($("#add_ua_group").val()==""){var a=guessUserAgentGroup($("#add_ua_user_agent").val());if(a!=""){$("#add_ua_group").attr("value",a)}else{a=guessUserAgentGroup($("#add_ua_name").val());if(a!=""){$("#add_ua_group").attr("value",a)}}}}function setStatus(a){}function addOption(){var a=getList();var b=new PresetSpoof($("#add_domain").val(),new UserAgent("title",$("#add_ua").val(),"vendor","badge",false));if(b.domain==""){setStatus("All fields are required.");$("#add_domain").toggleClass("error",true);$("#add_ua").toggleClass("error",true);return}chrome.extension.sendRequest({action:"add_preset",domain:document.getElementById("add_domain").value,option_index:$("#options").prop("selectedIndex")},function(c){restoreOptions()});setStatus("Blacklist entry added.");$("#add_domain").attr("value","");$("#add_ua").attr("value","")}function addUAOption(){if($("#add_ua_name").val()==""||$("#add_ua_user_agent").val()==""||$("#add_ua_indicator").val()==""){setStatus("All fields are required.");$("#add_ua_name").toggleClass("error",true);$("#add_ua_user_agent").toggleClass("error",true);$("#add_ua_indicator").toggleClass("error",true);return}addCustomUAOption($("#add_ua_name").val(),$("#add_ua_user_agent").val(),($("#add_ua_is_append").val()=="true"),$("#add_ua_indicator").val(),$("#add_ua_group").val());restoreOptions()}function populateTextFromDropdown(){$("#add_ua").attr("value",$("#options option:selected").val())}function refreshPresetOptions(){chrome.extension.sendRequest({action:"options"},function(b){preset_options=JSON.parse(b.options);var a=$("#options");if(a){for(var c=0;c<preset_options.length;c++){if(preset_options[c].ua_string!=""){var d=document.createElement("option");d.setAttribute("value",preset_options[c].ua_string);d.appendChild(document.createTextNode(preset_options[c].title));a.append(d)}}}})}function refreshPresetUserAgentOptions(){var options_map=getOptionsByGroup();var table=$("#ua_list_table");var group_index=0;for(group in options_map){group_index=group_index+1;table.append(getUATitleRow((group==""?"[No group]":group)));var list=options_map[group];var sub_table=document.createElement("table");var tr=document.createElement("tr");var td=document.createElement("td");td.appendChild(sub_table);tr.appendChild(td);table.append(tr);sub_table.setAttribute("id","ua_list_sub_table_"+group);sub_table.setAttribute("class","ua_list_sub_table");for(var i=0;i<list.length;i++){var deletebutton=document.createElement("div");deletebutton.setAttribute("class","deletebutton");deletebutton.setAttribute("border","0");deletebutton.setAttribute("alt","delete");deletebutton.setAttribute("id","delete_preset_"+group_index+"_"+i);sub_table.appendChild(_newRow([document.createTextNode(list[i].title),document.createTextNode(getDisplayUserAgentString(list[i])),document.createTextNode(getDisplayAppendOrReplaceString(list[i])),document.createTextNode(list[i].badge),(isRemovable(list[i])?deletebutton:document.createTextNode(""))]));$("#delete_preset_"+group_index+"_"+i).click((function(index,is_preset){return function(){deleteUAOption(index,eval(is_preset))}})(list[i].title,list[i].is_preset))}}}function getUATitleRow(c){var a=document.createElement("tr");var b=document.createElement("td");b.setAttribute("class","ua_title_row");b.appendChild(document.createTextNode(c));a.appendChild(b);return a}function _getOptionsDropdown(){var a=document.createElement("select");a.setAttribute("id","options");var b=document.createElement("option");b.setAttribute("value","");b.appendChild(document.createTextNode("[Default]"));a.appendChild(b);return a}function _newRow(a){var c=document.createElement("tr");for(var b=0;b<a.length;b++){if(!a[b]){continue}var d=document.createElement("td");d.appendChild(a[b]);c.appendChild(d)}return c}function addTitleRow(){var a=_newRow([document.createTextNode("Domain"),document.createTextNode("User-Agent String"),document.createTextNode(""),document.createTextNode("")]);a.setAttribute("class","title");return a}function addUATitleRow(){var a=_newRow([document.createTextNode("New User-agent name"),document.createTextNode("New User-Agent String"),document.createTextNode("Group"),document.createTextNode("Append?"),document.createTextNode("Indicator Flag"),document.createTextNode("")]);a.setAttribute("class","title");return a}function addNewEntryRow(){var b=document.createElement("input");var e=document.createTextNode("");var c=document.createElement("input");b.setAttribute("id","add_ua");b.setAttribute("type","hidden");c.setAttribute("id","add_domain");var d=document.createElement("input");d.type="button";d.setAttribute("id","add_entry_button");d.value="Add";var a=document.createElement("span");a.appendChild(b);a.appendChild(_getOptionsDropdown());return _newRow([c,a,e,d])}function addNewUAEntryRow(){var h=document.createElement("input");var f=document.createElement("input");var b=document.createElement("select");var e=document.createElement("input");var a=document.createElement("input");h.setAttribute("id","add_ua_name");f.setAttribute("id","add_ua_indicator");e.setAttribute("id","add_ua_user_agent");f.setAttribute("maxlength","3");f.setAttribute("size","3");b.setAttribute("id","add_ua_is_append");a.setAttribute("id","add_ua_group");var d=document.createElement("option");d.setAttribute("value","false");d.appendChild(document.createTextNode("Replace"));b.appendChild(d);var c=document.createElement("option");c.setAttribute("value","true");c.appendChild(document.createTextNode("Append"));b.appendChild(c);var g=document.createElement("input");g.type="button";g.setAttribute("id","add_ua_button");g.value="Add";return _newRow([h,e,a,b,f,g])}function deleteOption(c){var b=getList();for(var a=0;a<b.length;a++){if(b[a].domain==c){b.splice(a,1);break}}setList(b);setStatus("Spooflist entry deleted.");restoreOptions()}function deleteUAOption(a,b){var c=(b?"delete_base_ua":"delete_ua");chrome.extension.sendRequest({action:c,name:a},function(d){if(d.result=="success"){setStatus("User-agent deleted successfully.")}else{setStatus("User-agent deletion FAILED.")}restoreOptions()})}function restoreOptions(){var g=getList();var e=$("#list_table");if(e){e.replaceWith(document.createElement("table"))}e=$("#tablecontainer table");e.prop("id","list_table");e.append(addTitleRow());e.append(addNewEntryRow());$("#add_entry_button").click(function(){addOption()});$("#options").change(function(){populateTextFromDropdown()});for(var c=0;c<g.length;c++){var d=g[c];var b=document.createElement("div");b.setAttribute("alt","delete");b.setAttribute("id","delete_"+c);b.setAttribute("border","0");b.setAttribute("class","deletebutton");var f=_newRow([document.createTextNode(d.domain),document.createTextNode((d.user_agent.ua_string==""?"[Default]":d.user_agent.ua_string)),document.createTextNode(""),null,b]);e.append(f);$("#delete_"+c).click((function(h){return function(){deleteOption(h)}})(d.domain))}e=$("#ua_add_table");e.empty();var a=addUATitleRow();a.setAttribute("class","ua_list_sub_table");e.append(a);a=addNewUAEntryRow();a.setAttribute("class","ua_list_sub_table");e.append(a);$("#add_ua_button").click(function(){addUAOption()});$("#add_ua_user_agent").change(function(){guessGroup()});$("#add_ua_name").change(function(){guessGroup()});e=$("#ua_list_table");e.empty();$("#local_file_import").change(handleFileSelect);refreshPresetUserAgentOptions();refreshPresetOptions();refreshBuiltInListCheckbox();refreshPermanentOverrideCheckbox()}function menuItemChange(b,a){$(".menu_controlled").addClass("invisible");b.removeClass("invisible");$(".menuitem").removeClass("selected");a.addClass("selected")}function handleFileSelect(b){var d=b.target.files;for(var c=0,e;e=d[c];c++){var a=new FileReader();a.onload=(function(f){return function(h){var g=importUserAgentData(h.target.result);$("#import_result").empty();if(g.import_count==0&&g.duplicates==0){$("#import_result").append("No user-agent strings found.  Please be sure this is the correct XML format mentioned above.")}else{$("#import_result").append(document.createTextNode("Result: "+g.import_count+" imported successfully, "+g.duplicates+" duplicates removed."));restoreOptions()}}})(e);a.readAsText(e)}};