Function.prototype.delay=function(a,b,d){var e=this;var c=function(){e.apply(b,d);};return setTimeout(c,a);};Function.prototype.periodical=function(a,b,d){var e=this;var c=function(){e.apply(b,d);};return setInterval(c,a);};var Crossrider={manifest:{},_tabs:{},debug:false,_userCode:"",_bgCode:"",_plugins:{},_contextMenus:{},_cookies:{},_tabsUrlsByIds:{},_framesUrlsByIds:{},_isAlredyRegisterEventForWebRequest:false,_isAlredyRegisterEventForBeforeNavigate:false,_isAlredyRegisterEventForOldBeforeNavigate:false,_isAlredyRegisterEventForOldWebRequest:false,_notifications:{},_cookieInUpdate:{},_firstLoad:false,_isBgFinishInit:false,isStaging:false,isDuringUpdate:false,UPDATE_INTERVAL:360,events:Events,_cr_crossrider_ready_to_run_the_user_background_code:undefined,init:function(){try{this._loadLocalManifest();var d=localStorage.crx_version;if(Crossrider._isManifestVersion2()&&d!=Crossrider.manifest.version){var c=chrome.extension.getURL("js/app/extension.js");var b=chrome.extension.getURL("js/app/background.js");var a=Crossrider.Utils.fetchScript(c);var h=Crossrider.Utils.fetchScript(b);var f=Crossrider.manifest.crossrider.appID;DataStore.init(f,function(){DataStore.saveApp(f,a,parseInt(Crossrider.manifest.crossrider.jsVersion,10).toString(),function(){DataStore.saveBGApp(f,h,parseInt(Crossrider.manifest.crossrider.bgVersion,10).toString(),function(){DataStore.Plugins.savePluginsTypeList(PluginTypes.BACKGROUND,parseInt(Crossrider.manifest.crossrider.pluginsVersion,10).toString(),[],function(){DataStore.Plugins.savePluginsTypeList(PluginTypes.APP_CODE,parseInt(Crossrider.manifest.crossrider.pluginsVersion,10).toString(),[],function(){Crossrider.initAfterManifest2Changes();});});});});});}else{Crossrider.initAfterManifest2Changes();}}catch(g){Reports.error(new ErrorMessage(g,"Crossrider->init"));}},initAfterManifest2Changes:function(){try{this._initInternalMessaging();this._initStorage();this.events.tabClosed.addEventListener(function(c,b){delete this._tabsUrlsByIds[c];delete this._framesUrlsByIds[c];}.bind(this));}catch(a){Reports.error(new ErrorMessage(a,"Crossrider->initAfterManifest2Changes"));}},reportError:function(b,c){var a=new Error(b);Reports.error(new ErrorMessage(a,c));},_setInstallationTime:function(c,f){try{var b=this._cookies[TableNames.USER_COOKIES]["InstallationTime"];if(typeof(b)==="undefined"){b=c||Math.round((new Date()).getTime()/1000);var a=new Date(2030,1,1,0,0,0,0);this.setCookie("InstallationTime",b,a,TableNames.USER_COOKIES,undefined,f);}else{if(f){f();}}}catch(d){Reports.error(new ErrorMessage(d,"Crossrider->_setInstallationTime"));}},_initStorage:function(){try{var c;var b=GetSyncDBTableNamesArray();for(var a=0;a<b.length;++a){currentTableName=b[a];Crossrider._cookies[currentTableName]={};}CookieStore.init(this.appID,GetTableNamesArray(),function(){DataStore.init(this.appID,function(){DataStore.Plugins.getData(this._onPluginsRead.bind(this));}.bind(this));}.bind(this));}catch(d){Reports.error(new ErrorMessage(d,"Crossrider->_initStorage"));}},_onPluginsRead:function(a,b){try{this._plugins=a;if(b){return;}CookieStore.getCookies(this._onCookiesRead.bind(this),[TableNames.USER_COOKIES,TableNames.INTERNAL_DB]);}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->_onPluginsRead"));}},refreshMemoryCookiesFromDB:function(a){CookieStore.getCookies(function(b){Crossrider._copyDBCookiesToMemory(b);a();},[TableNames.USER_COOKIES,TableNames.INTERNAL_DB]);return InternalMessaging.responseLater;},_copyDBCookiesToMemory:function(b){try{for(var a in b){if(b.hasOwnProperty(a)){this._cookies[a]=b[a]||{};}}if(!this._cookies[TableNames.USER_COOKIES].hasOwnProperty("mysite")){this._cookies[TableNames.USER_COOKIES].mysite={};}}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->_copyDBCookiesToMemory"));}},_onCookiesRead:function(a){try{this._copyDBCookiesToMemory(a);this._startApplication();}catch(b){Reports.error(new ErrorMessage(b,"Crossrider->_onCookiesRead"));}},_startApplication:function(){try{if(this.debug){this._loadRemoteManifest();if(!this._plugins.hasOwnProperty("plugins_version")||(this._plugins.hasOwnProperty("plugins_version")&&this._plugins.plugins_version==0)){this.downloadAndSavePluginsInfo(this.manifest.pluginsurl,this.manifest.pluginsver,false,false,function(){this._getSiteCookies();}.bind(this));}else{this._getSiteCookies();}}else{DataStore.getData(this.appID,this._onAppDataLoad.bind(this));}}catch(a){Reports.error(new ErrorMessage(a,"Crossrider->_startApplication"));}},_getSiteCookies:function(){try{if(this.manifest.domain!==undefined&&this.manifest.domain!==null){var a=this.manifest.domain;if(a.indexOf("http")!=0){a="http://"+a;}chrome.cookies.getAll({url:a,domain:this.manifest.domain},function(g){if(!g||!g.length){this.setToolbarUniqueID();return;}for(var f=0,e=g.length;f<e;f++){var h=g[f],d=h.expirationDate!==undefined?new Date(h.expirationDate*1000).getTime():null;this._cookies[TableNames.USER_COOKIES].mysite[h.name]={value:h.value,expires:d};}this.setToolbarUniqueID();}.bind(this));}else{this.setToolbarUniqueID();}}catch(b){Reports.error(new ErrorMessage(b,"Crossrider->_getSiteCookies"));}},_setInstallationData:function(b){try{Crossrider._setInstallationParams(function(){Crossrider._setInstallationThankYouPage(function(){Crossrider._setChromeEnabled(function(){b();});});});}catch(a){Reports.error(new ErrorMessage(a,"Crossrider->_setInstallationData"));}},_setInstallationParams:function(c){try{if(!Crossrider._cookies[TableNames.USER_COOKIES].hasOwnProperty("InstallerParams")&&Crossrider.manifest.crossrider.hasOwnProperty("InstallerParams")){var a=new Date(2030,1,1,0,0,0,0);Crossrider.setCookie("InstallerParams",Crossrider.manifest.crossrider.InstallerParams,a,TableNames.USER_COOKIES,undefined,c);}else{c();}}catch(b){Reports.error(new ErrorMessage(b,"Crossrider->_setInstallationParams"));}},_setChromeEnabled:function(c){try{if(!Crossrider._cookies[TableNames.INTERNAL_DB].hasOwnProperty("chrome_enabled")&&Crossrider.manifest.crossrider.hasOwnProperty("chrome_enabled")){var a=new Date(2030,1,1,0,0,0,0);Crossrider.setCookie("chrome_enabled",Crossrider.manifest.crossrider.chrome_enabled,a,TableNames.INTERNAL_DB,undefined,c);}else{c();}}catch(b){Reports.error(new ErrorMessage(b,"Crossrider->_setChromeEnabled"));}},_setInstallationThankYouPage:function(c){try{if(!Crossrider._cookies[TableNames.USER_COOKIES].hasOwnProperty("InstallationThankYouPage")&&Crossrider.manifest.crossrider.hasOwnProperty("InstallationThankYouPage")){var a=new Date(2030,1,1,0,0,0,0);Crossrider.setCookie("InstallationThankYouPage",Crossrider.manifest.crossrider.InstallationThankYouPage,a,TableNames.USER_COOKIES,undefined,c);}else{c();}}catch(b){Reports.error(new ErrorMessage(b,"Crossrider->_setInstallationThankYouPage"));}},_initAppAPI:function(){try{crLogger.trace("_initAppAPI : start");window.appAPI=new AppApi();window.appAPI.init(this._cookies);chrome.cookies.onChanged.addListener(this._onCookieChange.bind(this));this._loadUserScript();this._loadBackgroundScript();this._firstLoad=(localStorage.firstLoad!=="false");var a=this;if(this._firstLoad){this._setInstallationData(function(){a._setInstallationTime(undefined,function(){var d=document.createEvent("Events");d.initEvent("cr_ready",true,false);document.dispatchEvent(d);a._isBgFinishInit=true;if(a.debug){return;}Reports.install();Reports.update();Reports.dailyStats();a._showThankyouPage();localStorage.firstLoad="false";});});}else{var b=document.createEvent("Events");b.initEvent("cr_ready",true,false);document.dispatchEvent(b);this._isBgFinishInit=true;}if(!this.debug){this._checkNextUpdate.periodical(60*1000,this);}}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->_initAppAPI"));}},_onAppDataLoad:function(d){try{var c=localStorage.crx_version;if(d.manifest&&d.app&&c===this.manifest.version){this._parseManifestXML(d.manifest.value);this._user_script=d.app||{value:"",version:this.manifest.ver};this._bg_script=d.bg_script||{value:"",version:this.manifest.backgroundver};this._getSiteCookies();}else{if(Crossrider._isManifestVersion2()){this._user_script=d.app||{value:"",version:this.manifest.ver};this._bg_script=d.bg_script||{value:"",version:this.manifest.backgroundver};}var a=true;var b=this._updateAppAndManifest(a);if(!b){setTimeout(function(){Crossrider._onAppDataLoad(d);},60*1000);}else{}}}catch(f){Reports.error(new ErrorMessage(f,"Crossrider->_onAppDataLoad"));}},_setExtID:function(){try{var a=chrome.extension.getURL("manifest.json");var b=a.replace(/chrome\-extension\:\/\//,"");this.extensionID=b.substr(0,b.indexOf("/"));}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->_setExtID"));}},_loadLocalManifestByName:function(b){try{var c={};if(b&&typeof b==="string"){var a=chrome.extension.getURL(b);if(a){c=JSON.parse(Crossrider.Utils.fetchScript(a));}}return c;}catch(d){Reports.error(new ErrorMessage(d,"Crossrider->_loadLocalManifestByName"));}},_loadCromeLocalManifest:function(){return this._loadLocalManifestByName("manifest.json");},_loadCrossriderLocalManifest:function(){return this._loadLocalManifestByName("crossriderManifest.json");},_loadLocalManifest:function(){try{this._setExtID();this.manifest=this._loadCromeLocalManifest();this.manifest.crossrider={};var a=this._loadCrossriderLocalManifest();if(a&&a.hasOwnProperty("crossrider")){this.manifest.crossrider=a.crossrider;}this.manifest.platform="CH";this.debug=this.manifest.crossrider.debug=false;this.appID=this.manifest.crossrider.appID;if((localStorage.hasOwnProperty("forceDebug")&&(localStorage.getItem("forceDebug")==="true"))&&localStorage.hasOwnProperty("internaldebug_userCode")&&localStorage.hasOwnProperty("internaldebug_backgroundCode")){this.debug=this.manifest.crossrider.debug=true;this.manifest.crossrider.user_script=localStorage.getItem("internaldebug_userCode");this.manifest.crossrider.background_script=localStorage.getItem("internaldebug_backgroundCode");}if(this.manifest.crossrider.hasOwnProperty("is_staging")){this.isStaging=this.manifest.crossrider.is_staging;}}catch(b){Reports.error(new ErrorMessage(b,"Crossrider->_loadLocalManifest"));}},getIntrnalDebugUrls:function(a){a({userCode:localStorage.hasOwnProperty("internaldebug_userCode")?localStorage.getItem("internaldebug_userCode"):"",backgroundCode:localStorage.hasOwnProperty("internaldebug_backgroundCode")?localStorage.getItem("internaldebug_backgroundCode"):""});},switchInternalDebug:function(a,b){try{if(!a){localStorage.setItem("forceDebug",false);}else{localStorage.setItem("forceDebug",true);localStorage.setItem("internaldebug_userCode",b.userCode);localStorage.setItem("internaldebug_backgroundCode",b.backgroundCode);}this.reload();}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->switchInternalDebug"));}},_loadRemoteManifest:function(b){try{var d=(Crossrider.manifest.version.split(".")[0]?Crossrider.manifest.version.split(".")[0]:"0")+"_"+(Crossrider.manifest.version.split(".")[1]?Crossrider.manifest.version.split(".")[1]:"0");var a;if(this.manifest){if(this.manifest.hasOwnProperty("crossrider")&&this.manifest.crossrider.hasOwnProperty("manifestHostUrl")){a=this.manifest.crossrider.manifestHostUrl+"/plugin/apps/"+this.appID+"/manifest/"+d+"/ch/manifest.xml";}if(this.manifest.manifest){a=this.manifest.manifest;}}if(b){if(a.indexOf("?")>0){a+="&rnd="+(new Date()).getTime();}else{a+="?rnd="+(new Date()).getTime();}}var c=Crossrider.Utils.fetchScript(a);if(c){if(!this._parseManifestXML(c)){return false;}}return c;}catch(f){Reports.error(new ErrorMessage(f,"Crossrider->_loadRemoteManifest"));}},getScript:function(c,b,a){try{if(c.toLowerCase()==="na"){a("");return;}if(b){if(c.indexOf("?")>0){c+="&rnd="+(new Date()).getTime();}else{c+="?rnd="+(new Date()).getTime();}}Crossrider.request({url:c,async:true},function(e){if(e.call=="success"){a(e.response);}else{setTimeout(function(){Crossrider.getScript(c,b,a);},60*1000);}}.bind(this));}catch(d){Reports.error(new ErrorMessage(d,"Crossrider->getScript"));}},saveNewPlugins:function(c,e,b,a,d){DataStore.Plugins.removeAllPlugins(function(){DataStore.Plugins.savePlugins(e,function(){var f=0;for(plugins_type in b){f++;}for(plugins_type in b){b[plugins_type].sort(function(h,g){return g.order-h.order;});DataStore.Plugins.savePluginsTypeList(plugins_type,c,b[plugins_type],function(){--f;if(f===0){var l={plugins_list_info:{},plugins_order:[],plugins_version:parseInt(c)};for(var h=0,i=e.length;h<i;++h){l.plugins_list_info[e[h].id]={name:e[h].name,version:e[h].version,code:e[h].code};}for(current_plugin_type in b){var g=[];for(var h=0,i=b[current_plugin_type].length;h<i;++h){if(b[current_plugin_type][h].hasOwnProperty("id")){g.push(b[current_plugin_type][h].id);}}l.plugins_order[current_plugin_type]=g.reverse().join(",").toString();}if(!a){var k=Crossrider._plugins.plugins_order[PluginTypes.BACKGROUND],j=l.plugins_order[PluginTypes.BACKGROUND];if(k!==j){a=true;}}this._onPluginsRead(l,true);if(d){d(true,a);}}}.bind(this));}}.bind(this),function(){});}.bind(this));},downloadAndSavePluginsInfo:function(d,i,b,g,j){var h=[],e={},a=0,f=false;function c(o,q,n,m){try{var l={id:o.id,version:o.ver,name:o.name};for(var p=0,k=o.targets.length;p<k;++p){if(e.hasOwnProperty(o.targets[p].run_at)){if((o.targets[p].run_at==PluginTypes.BACKGROUND)&&m){f=true;}e[o.targets[p].run_at].push({id:l.id,order:o.targets[p].order,name:l.name});}}l.code=q;h.push(l);if(h.length==a){Crossrider.saveNewPlugins(i,h,e,f,j);}}catch(r){Reports.error(new ErrorMessage(r,"Crossrider->downloadAndSavePluginsInfo->saveCurrentPlugin"));}}if(d===null||d.trim().length===0){DataStore.Plugins.removeAllPlugins(function(){j(false);});return;}this.getScript(d,b,function(m){try{var u=JSON.parse(m);if(!u.hasOwnProperty("plugins_list")){j(false);return;}u=u.plugins_list;for(var l in PluginTypes){e[PluginTypes[l]]=[];}var v=[];for(var n=0,o=u.length;n<o;++n){if(u[n].enabled&&u[n].browsers.ch){if(u[n].targets.length>0){var p=false;for(var x=0,k=u[n].targets.length;x<k&&!p;++x){p=e.hasOwnProperty(u[n].targets[x].run_at);}if(p){v.push(u[n]);}}}}u=v;a=u.length;if(v.length==0){j(true);return;}var t=this;if(Crossrider._isManifestVersion2()&&!g){for(var n=0,o=a;n<o;++n){var w=0;if(this._plugins.plugins_list_info.hasOwnProperty(u[n].id)){w=this._plugins.plugins_list_info[u[n].id].version;}if(w<u[n].ver){for(var x=0,k=u[n].targets.length;x<k;++x){if(e.hasOwnProperty(u[n].targets[x].run_at)){if(u[n].targets[x].run_at==PluginTypes.BACKGROUND){var r=true;j(null,null,r);return;}}}}}}for(var n=0,o=a;n<o;++n){var w=0;if(this._plugins.plugins_list_info.hasOwnProperty(u[n].id)){w=this._plugins.plugins_list_info[u[n].id].version;}if(w<u[n].ver){var q=u[n].url;this.getScript(u[n].url+"?ver="+u[n].ver,b,(function(z,y){return function(A){c.apply(t,[z[y],A,z,true]);};})(u,n));}else{c(u[n],this._plugins.plugins_list_info[u[n].id].code,u,false);}}}catch(s){Reports.error(new ErrorMessage(s,"Crossrider->downloadAndSavePluginsInfo"));}}.bind(this));},_isManifestVersion2:function(){return Crossrider.manifest.hasOwnProperty("manifest_version")&&Crossrider.manifest.manifest_version==2;},_updateAppAndManifest:function(p,a){try{var f=this._loadRemoteManifest(a);if(!f){return false;}var h=Crossrider.Utils.toInt(this.manifest.ver),o=Crossrider.Utils.toInt(this.manifest.backgroundver),k=Crossrider.Utils.toInt(this.manifest.pluginsver);var d=this._user_script?Crossrider.Utils.toInt(this._user_script.version):0;var l=this._bg_script?Crossrider.Utils.toInt(this._bg_script.version):0;var c=this._plugins.plugins_version;var b=h>d,n=o>l,m=k>c;if(Crossrider._isManifestVersion2()&&n){DataStore.saveManifest(this.appID,f,function(){if(localStorage.crx_version===undefined||localStorage.crx_version!==Crossrider.manifest.version){localStorage.crx_version=Crossrider.manifest.version;}if(p){Crossrider._getSiteCookies();}});return true;}var g=false;if(Crossrider._isManifestVersion2()&&b&&!m&&d==Crossrider.manifest.crossrider.jsVersion){m=true;g=true;}if(Crossrider._isManifestVersion2()&&m&&!b&&c==Crossrider.manifest.crossrider.pluginsVersion){b=true;}var j=this;DataStore.saveManifest(this.appID,f,function(){if(localStorage.crx_version===undefined||localStorage.crx_version!==j.manifest.version){localStorage.crx_version=j.manifest.version;}var r=null,e=null;var w=0;if(b){++w;}if(n){++w;}if(w==0&&!m){if(Crossrider._isManifestVersion2()&&p){Crossrider._getSiteCookies();}return;}function t(y){try{if(y){setTimeout(function(){j.reload();},500);}else{if(p){j._getSiteCookies();}}}catch(x){Reports.error(new ErrorMessage(x,"Crossrider->_updateAppAndManifest->fourthStep"));}}function v(y){try{if(b&&typeof(r)==="string"){j._user_script={value:r,version:j.manifest.ver};j._loadUserScript();DataStore.saveApp(j.appID,r,j.manifest.ver,function(){t(y);});}else{t(y);}}catch(x){Reports.error(new ErrorMessage(x,"Crossrider->_updateAppAndManifest->thirdStep"));}}function s(x){try{if(n&&typeof(e)==="string"){DataStore.saveBGApp(j.appID,e,j.manifest.backgroundver,function(){j._bg_script={value:e,version:j.manifest.backgroundver};v(true);});}else{v(x);}}catch(y){Reports.error(new ErrorMessage(y,"Crossrider->_updateAppAndManifest->secondStep"));}}function u(){try{if(m){Crossrider.downloadAndSavePluginsInfo(j.manifest.pluginsurl,j.manifest.pluginsver,a,g,function(y,z,A){if(A){if(p){Crossrider._getSiteCookies();}return;}s(z);});}else{s(false);}}catch(x){Reports.error(new ErrorMessage(x,"Crossrider->_updateAppAndManifest->firstStep"));}}function q(){try{--w;if(w!=0){return;}if(!p){Reports.update(d);}u();}catch(x){Reports.error(new ErrorMessage(x,"Crossrider->_updateAppAndManifest->finishLoadUserScripts"));}}if(!b&&!n&&m){u();}else{if(b){j.getScript(j.manifest.jslink,a,function(x){r=x;q();});}if(n){j.getScript(j.manifest.backgroundjs,a,function(x){e=x;q();});}}});return true;}catch(i){Reports.error(new ErrorMessage(i,"Crossrider->_updateAppAndManifest"));}},_parseManifestXML:function(c){try{var j=new DOMParser();var g=j.parseFromString(c,"text/xml");if(g.getElementsByTagName("CrAppInfo").length==0){return false;}var b=g.getElementsByTagName("CrAppInfo")[0].childNodes;for(var d=0,a=b.length;d<a;d++){var f=b[d];if((typeof(f)!=="undefined")&&f&&f.nodeType===1){this.manifest[f.nodeName.toLowerCase()]=f.childNodes.length>0?(f.childNodes[0].nodeValue==="NA"?null:f.childNodes[0].nodeValue):null;}}if(this.manifest.hasOwnProperty("updateinterval")){this.manifest.updateinterval=parseInt(this.manifest.updateinterval);}else{this.manifest.updateinterval=this.UPDATE_INTERVAL;}return true;}catch(h){Reports.error(new ErrorMessage(h,"Crossrider->_parseManifestXML"));}},_initInternalMessaging:function(){if(typeof chrome.extension.onMessage==="undefined"){chrome.extension.onRequest.addListener(this._onRequest.bind(this));}else{chrome.extension.onMessage.addListener(this._onRequest.bind(this));}},_registerOldWebRequestOnce:function(){if(!Crossrider._isAlredyRegisterEventForOldWebRequest){Crossrider._isAlredyRegisterEventForOldWebRequest=true;try{Crossrider.events.oldWebRequest.init();}catch(a){Reports.error(new ErrorMessage(a,"Crossrider->_registerOldWebRequestOnce"));}}},_registerOldOnceOnBeforeNavigate:function(){if(!Crossrider._isAlredyRegisterEventForOldBeforeNavigate){Crossrider._isAlredyRegisterEventForOldBeforeNavigate=true;try{Crossrider.events.oldBeforeNavigate.init();}catch(a){Reports.error(new ErrorMessage(a,"Crossrider->_registerOldOnceOnBeforeNavigate"));}}},_registerWebRequestOnce:function(){if(!Crossrider._isAlredyRegisterEventForWebRequest){Crossrider._isAlredyRegisterEventForWebRequest=true;try{Crossrider.events.webRequest.init();}catch(a){Reports.error(new ErrorMessage(a,"Crossrider->_registerOnceOnBeforeRequest"));}}},_registerOnceOnBeforeNavigate:function(){if(!Crossrider._isAlredyRegisterEventForBeforeNavigate){Crossrider._isAlredyRegisterEventForBeforeNavigate=true;try{Crossrider.events.beforeNavigate.init();}catch(a){Reports.error(new ErrorMessage(a,"Crossrider->_registerOnceOnBeforeNavigate"));}}},_onRequest:function(d,c,a){try{var f=d.action;var b=!(InternalMessaging.responseLater);if(f&&typeof(this[f])==="function"){var h=d.params&&typeof(d.params["push"])==="function"?d.params:[];if(d.hasOwnProperty("passCallback")&&d.passCallback===true){h.push(a);isCallbackPassed=true;}else{if(d.hasOwnProperty("passSuccessFailure")&&d.passSuccessFailure===true){h.push(d.onSuccess);h.push(d.onFailure);}}if(f==="addUserScripts"||f==="getAppData"){h.push(c.tab);}if(f==="request"){h.push(InternalMessaging.responseLater);}b=this[f].apply(this,h);return b;}}catch(g){Reports.error(new ErrorMessage(g,"Crossrider->_onRequest"));}},_loadBackgroundScript:function(){try{if(this.debug){var b=this.manifest.crossrider.background_script;if(!(/^https?\:\/\//.test(b))){b=chrome.extension.getURL(b);}this._bg_script={value:Crossrider.Utils.fetchScript(b),version:this.manifest.backgroundver};}if(this._bg_script!==undefined){this._bgCode=Crossrider.CodeParser.parse(this._bg_script.value);if(Crossrider._isManifestVersion2()){}else{var a=DataStore.Plugins.getPluginsCodeByType(PluginTypes.BACKGROUND,this._plugins,this.debug);var d="\n\n"+a+"\n\n"+this._bgCode+"\n\n";if(this.manifest.backgroundjs.toLowerCase()==="na"){this._cr_crossrider_ready_to_run_the_user_background_code=function(){};}else{try{this._cr_crossrider_ready_to_run_the_user_background_code=new Function(d);}catch(c){this._cr_crossrider_ready_to_run_the_user_background_code=function(){};UserReport.error(new ErrorMessage(c,"background.js"));}}}}}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->_loadBackgroundScript"));}},_loadUserScript:function(){try{if(this.debug){var a=this.manifest.crossrider.user_script;if(!(/^https?\:\/\//.test(a))){a=chrome.extension.getURL(a);}var b=Crossrider.Utils.fetchScript(a);this._parseUserScripts(b);}else{this._parseUserScripts(this._user_script.value);}}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->_loadUserScript"));}},_parseUserScripts:function(a){this._userCode=Crossrider.CodeParser.reset().parse(a);},addUserScripts:function(a){crLogger.trace("addUserScripts : start");try{if(!a||!a.hasOwnProperty("id")||a.id<0){return;}if(this.debug){this._loadUserScript();}var b=Crossrider.CodeParser.includes.DOM.css;if(this._cookies[TableNames.USER_COOKIES].mysite===undefined){this._cookies[TableNames.USER_COOKIES].mysite={};}chrome.tabs.get(a.id,function(d){if(!d){return;}if(d.url.indexOf("http")==0){var e=this;InternalMessaging.messageToPage(d.id,{action:"initContentScript",passCallback:true,params:[b,this._bic]},function(){if(typeof e._userCode=="string"){var f=DataStore.Plugins.getPluginsCodeByType(PluginTypes.APP_CODE,e._plugins,e.debug);var h='if (!window._cr_is_already_run && typeof appAPI !== "undefined" && appAPI._cr_app_api_page_ready) { window._cr_is_already_run = true; \n\n'+f+"\n\n"+e._userCode+"\n\n }";try{chrome.tabs.executeScript(d.id,{code:h,allFrames:(Crossrider.manifest.runiniframe==="true")});}catch(g){UserReport.error(new ErrorMessage(g,"extension.js"));}}});}}.bind(this));}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->addUserScripts"));}},getAppData:function(a,b){crLogger.trace("getAppData : start");if(!b||!b.id){return;}if(!Crossrider._isBgFinishInit){setTimeout(function(){Crossrider.getAppData(a,b);},50);return InternalMessaging.responseLater;}var c=Crossrider._cookies;c._cr_verify_cookies_are_good=true;try{a({tabID:b.id,manifest:Crossrider.manifest,_cookies:c});}catch(d){Reports.error(new ErrorMessage(d,"Crossrider->getAppData"));crLogger.error("Crossrider->getAppData");}},_onTabSelectionChanged:function(a){},request:function(a,f,b){try{a.callback=f;a.async=a.async===undefined?true:a.async;var d=new XHR(a);if((IsDefined(b)&&b===InternalMessaging.responseLater)){setTimeout(function(){d.send();},20);return InternalMessaging.responseLater;}else{return d.send();}}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->request"));}},requestBinary:function(b,g){if(!b){return;}if(typeof b.url!=="string"){g({call:"fail",response:-1});return;}var f=new XMLHttpRequest(),d,a,e,c;if(typeof Uint8Array=="undefined"){g({call:"fail",response:-2});return;}f.open("GET",b.url,true);f.responseType="arraybuffer";f.onload=function(h){if(this.status==200){d=new Uint8Array(this.response);c=d.length;a=new Array(c);while(c--){a[c]=String.fromCharCode(d[c]);}e=a.join("");g({call:"success",response:b.base64?window.btoa(e):e});}else{g({call:"fail",response:this.status});}};f.send();return InternalMessaging.responseLater;},openURL:function(b,a){try{if(a==="current"){this._getCurrentActiveTabs(function(f){try{if(f.length==0){return;}for(var d=0;d<f.length;++d){var g=f[d];if(IsDefined(g)){chrome.tabs.update(g.tabID,{url:b});}}}catch(h){Reports.error(new ErrorMessage(h,"Crossrider->openURL->current"));}});}else{chrome[a==="tab"?"tabs":"windows"].create({url:b});}}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->openURL"));}},superAlert:function(a){alert(a);},getTableName:function(a){try{for(var b in TableNames){if(b.toLowerCase().indexOf("length")<0){if(TableNames[b]===a){return a;}}}return TableNames.USER_COOKIES;}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->getTableName"));}},updateCookieExpiration:function(c,a,b){try{a=typeof(a)==="number"?new Date(a):a;b=this.getTableName(b);CookieStore.updateCookieExpiration(c,a,b,function(){if(typeof a==="number"||a instanceof Date){if(a instanceof Date){a=a.getTime();}this._cookies[b][c].expires=a;this._broadcastAllTabs("updateCookieExpiration",[c,a,b]);}else{Reports.error(new ErrorMessage(new Error("Invalid expires value"),"Crossrider->getTableName"));}}.bind(this));}catch(d){Reports.error(new ErrorMessage(d,"Crossrider->getTableName"));}},setCookie:function(f,g,a,c,b,i){try{c=this.getTableName(c);_this=this;if(f==="mysite"){return;}var d=new Date().getTime(),a=new Date(a).getTime();if(d>a){if(_this._cookies[c][f]){_this.unsetCookie(f,c);}}else{CookieStore.setCookie(f,g,a,c,function(){_this._cookies[c][f]={value:g,expires:a};_this._broadcastAllTabs("updateCookie",[f,_this._cookies[c][f],c],b);if(i){i();}},function(){_this._broadcastAllTabs("unsetCookie",[f,c]);});}return InternalMessaging.responseLater;}catch(h){Reports.error(new ErrorMessage(h,"Crossrider->getTableName"));}},removeExpiredCookies:function(a){a=this.getTableName(a);CookieStore.removeExpiredCookies(a,function(f){try{if(f.length>0){for(var c=0;c<f.length;++c){var b=f[c];if((f.indexOf(b)>=0)&&this._cookies[a].hasOwnProperty(b)){delete this._cookies[a][b];}}this._broadcastAllTabs("removeExpiredCookies",[a,f]);}}catch(d){Reports.error(new ErrorMessage(d,"Crossrider->removeExpiredCookies"));}}.bind(this));},unsetCookie:function(b,a,c){a=this.getTableName(a);if(this._cookies[a][b]){CookieStore.unsetCookie(b,a,function(){delete this._cookies[a][b];this._broadcastAllTabs("unsetCookie",[b,a]);if(c){c();}}.bind(this));}return InternalMessaging.responseLater;},removeAllCookies:function(b,c,d){var b=this.getTableName(b);if(c){CookieStore.clearDataWithExcludedFields(b,d);}else{var a=true;CookieStore.clearData(b,a);}this._broadcastAllTabs("removeAllCookies",[b,c,d]);},_callbackRunner:function(c,b){try{if(c&&typeof c==="function"){c(b);}}catch(a){Reports.error(new ErrorMessage(a,"Crossrider->_callbackRunner"));}},_callbackCreator:function(a){if(a&&typeof a==="function"){a(params);}},getCookieAsync:function(a,b,c){CookieStore.getCookie(a,b,function(g){try{if(g&&g.hasOwnProperty("expires")){var f=new Date().getTime();var d=new Date(g.expires).getTime();if(f>d){this.unsetCookieAsync(b,a,function(){g=null;this._callbackRunner(c,g);}.bind(this));}else{this._callbackRunner(c,g);}}else{g=null;this._callbackRunner(c,g);}}catch(h){Reports.error(new ErrorMessage(h,"Crossrider->getCookieAsync"));}}.bind(this));return InternalMessaging.responseLater;},getAllCookiesAsync:function(a,b){this.removeExpiredCookiesAsync(a,function(){CookieStore.getCookies(function(f){try{var c={};if(f){for(var d in f){if(d==a){if(f.hasOwnProperty(d)){c=f[d];break;}}}this._callbackRunner(b,c);}else{this._callbackRunner(b,c);}}catch(g){Reports.error(new ErrorMessage(g,"Crossrider->getAllCookiesAsync"));}}.bind(this),[a]);}.bind(this));return InternalMessaging.responseLater;},setCookieAsync:function(a,h,c,i,j){try{var g=true;var d=this;if(IsValidTableName(i)){var b=new Date().getTime();var c=new Date(c).getTime();if(b>c){d.unsetCookieAsync(a,i,function(){d._callbackRunner(j,!g);});}else{CookieStore.setCookie(a,h,c,i,function(){d._callbackRunner(j,g);},function(){d._callbackRunner(j,!g);});}}else{d._callbackRunner(j,!g);}return InternalMessaging.responseLater;}catch(f){Reports.error(new ErrorMessage(f,"Crossrider->setCookieAsync"));}},unsetCookieAsync:function(b,a,f){try{var c=true;if(IsValidTableName(a)){CookieStore.unsetCookie(b,a,function(){this._callbackRunner(f,c);}.bind(this));return InternalMessaging.responseLater;}else{this._callbackRunner(f,!c);}}catch(d){Reports.error(new ErrorMessage(d,"Crossrider->unsetCookieAsync"));}},removeAllCookiesAsync:function(b,f){try{var c=true;var a=true;if(IsValidTableName(b)){CookieStore.clearData(b,a,function(){this._callbackRunner(f,c);}.bind(this));return InternalMessaging.responseLater;}else{this._callbackRunner(f,!c);}}catch(d){Reports.error(new ErrorMessage(d,"Crossrider->unsetCookieAsync"));}},removeExpiredCookiesAsync:function(a,d){try{var c=true;if(IsValidTableName(a)){CookieStore.removeExpiredCookies(a,function(e){this._callbackRunner(d,c);}.bind(this));return InternalMessaging.responseLater;}else{this._callbackRunner(d,!c);}}catch(b){Reports.error(new ErrorMessage(b,"Crossrider->unsetCookieAsync"));}},updateCookieExpirationAsync:function(f,b,c,h){try{b=typeof(b)==="number"?new Date(b):b;var a=true;if(IsValidTableName(c)){var d=new Date().getTime();if(!(b instanceof Date)&&(typeof(b)!=="number")){this._callbackRunner(h,!a);}else{if(typeof(b)==="number"){b=new Date(b);}if(d>b.getTime()){this.unsetCookieAsync(f,c,function(){this._callbackRunner(h,!a);}.bind(this));}else{CookieStore.updateCookieExpiration(f,b,c,function(){this._callbackRunner(h,a);}.bind(this));}return InternalMessaging.responseLater;}}else{this._callbackRunner(h,!a);}}catch(g){Reports.error(new ErrorMessage(g,"Crossrider->updateCookieExpirationAsync"));}},setRealCookie:function(d,f,a){try{if(this.manifest.domain!==undefined&&this.manifest.domain!==null){var c=new Date().getTime(),h=a?new Date(a).getTime():null;if(h!==null&&c>h){if(this._cookies[TableNames.USER_COOKIES].mysite[d]){this.unsetRealCookie(d);}}else{var b=this.manifest.domain;if(b.indexOf("http")!=0){b="http://"+b;}if(h!==null){chrome.cookies.set({url:b,name:d,value:f,expirationDate:Math.round(h/1000),path:"/"});}else{chrome.cookies.set({url:b,name:d,value:f,path:"/"});}this._cookies[TableNames.USER_COOKIES].mysite[d]={value:f,expires:h};}}}catch(g){Reports.error(new ErrorMessage(g,"Crossrider->setRealCookie"));}},unsetRealCookie:function(b){try{if(this.manifest.domain!==undefined&&this.manifest.domain!==null){if(this._cookies[TableNames.USER_COOKIES].mysite[b]){var a=this.manifest.domain;if(a.indexOf("http")!=0){a="http://"+a;}chrome.cookies.remove({url:a,name:b});delete this._cookies[TableNames.USER_COOKIES].mysite[b];}}}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->unsetRealCookie"));}},_onCookieChange:function(c){try{if(this.manifest.domain===undefined||this.manifest.domain===null||c.cookie.domain.indexOf(this.manifest.domain)<0){return;}else{if(c.removed){if(this._cookies[TableNames.USER_COOKIES].mysite[c.cookie.name]!==undefined){delete this._cookies[TableNames.USER_COOKIES].mysite[c.cookie.name];}}else{var d=c.cookie.expirationDate?c.cookie.expirationDate*1000:null;var a=new Date().getTime();if((d!==null&&a>d)||c.cookie.session){d=null;}this._cookies[TableNames.USER_COOKIES].mysite[c.cookie.name]={value:c.cookie.value,expires:d};}}}catch(b){Reports.error(new ErrorMessage(b,"Crossrider->_onCookieChange"));}},_broadcastAllTabs:function(d,g,b,c){try{var a=[];if(c){a.push(b);}this._borodcastMessage(a,{action:d,params:g,__isCrossriderInternalMessage__:true});if(window.appAPI&&typeof window.appAPI[d]==="function"){window.appAPI[d].apply(appAPI,g);}}catch(f){Reports.error(new ErrorMessage(f,"Crossrider->_broadcastAllTabs"));}},_borodcastMessage:function(b,c){try{var a="http";chrome.windows.getAll({populate:true},function(e){e.forEach(function(f){f.tabs.forEach(function(g){if(typeof g!="undefined"&&g.hasOwnProperty("id")&&g.hasOwnProperty("url")&&(b.indexOf(g.id)<0)&&(g.url.indexOf(a)==0)){var h={action:"handleMessage",params:[c]};if(c.hasOwnProperty("action")&&c.hasOwnProperty("__isCrossriderInternalMessage__")&&c.__isCrossriderInternalMessage__){h.action=c.action;h.params=c.params;}InternalMessaging.messageToPage(g.id,h);}});});});}catch(d){Reports.error(new ErrorMessage(d,"Crossrider->_borodcastMessage"));}},_getCurrentActiveTabs:function(g,f){function b(p,o){try{var h=[];var k="http";for(var l=0;l<p.length;++l){var n=p[l];if(typeof n!="undefined"&&n.hasOwnProperty("url")&&n.url.indexOf(k)==0){var j=new TabInfo(n);h.push(j);}}o(h);}catch(m){Reports.error(new ErrorMessage(m,"Crossrider->_getCurrentActiveTabs->_tabQueryHandler"));}}try{if(typeof g=="function"){if(typeof f!="undefined"){chrome.tabs.get(f,function(e){g([e]);});}else{var d={active:true};var a=parseInt(window.navigator.appVersion.match(/Chrome\/(\d+)\./)[1],10);if(a>=23){d.windowId=chrome.windows.WINDOW_ID_CURRENT;}if(!chrome.tabs.hasOwnProperty("query")||typeof chrome.tabs.query=="undefined"){Reports.error(new ErrorMessage(new Error("query is undefined chromeVer="+a),"Crossrider->_getCurrentActiveTabs"));}chrome.tabs.query(d,function(e){b(e,g);}.bind(this));}}}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->_getCurrentActiveTabs"));}},_sendMessageToActiveTabs:function(b,a){try{if(IsDefined(a)&&typeof a==="number"){InternalMessaging.messageToPage(a,{action:"handleMessage",params:[b]});}else{this._getCurrentActiveTabs(function(f){for(var d=0;d<f.length;++d){var e=f[d];if(e.hasOwnProperty("tabID")){InternalMessaging.messageToPage(e.tabID,{action:"handleMessage",params:[b]});}}},a);}}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->_sendMessageToActiveTabs"));}},message:function(c,f,b){try{switch(c){case"active":this._sendMessageToActiveTabs(f,b);break;case"all":this._borodcastMessage([],f);break;case"to_tab":this._sendMessageToActiveTabs(f,b);break;case"background":window.appAPI.message.call(f);break;case"allOtherTabs":this._borodcastMessage([b],f);break;case"popup":f.isToPopup=true;var a=chrome.extension.getViews({type:"popup"});if(a.length>0){a[0].appAPI.message.call(f);}break;}}catch(d){Reports.error(new ErrorMessage(d,"Crossrider->message"));}},setToolbarUniqueID:function(b){try{if(localStorage.bic){this._bic=localStorage.bic;}else{localStorage.bic=this._bic=Crossrider.Utils.getUID();}if(typeof(b)==="function"){b(this._bic);}else{this._initAppAPI();}}catch(a){Reports.error(new ErrorMessage(a,"Crossrider->setToolbarUniqueID"));}},getAppID:function(a){a(this.appID);},_showThankyouPage:function(){try{var a=false;if(this._cookies[TableNames.USER_COOKIES].hasOwnProperty("InstallationThankYouPage")){if(this._cookies[TableNames.USER_COOKIES]["InstallationThankYouPage"].value){a=true;}}if(this.manifest.thanksurl&&this._firstLoad&&!a){chrome.tabs.create({url:this.manifest.thanksurl},function(){});}}catch(b){Reports.error(new ErrorMessage(b,"Crossrider->_showThankyouPage"));}},_checkNextUpdate:function(){try{if(Crossrider.isDuringUpdate){return;}if(!localStorage.nextUpdate){localStorage.nextUpdate=(new Date()).getTime()+(this.manifest.updateinterval*60*1000);}var a=(new Date()).getTime(),b=parseInt(localStorage.nextUpdate);if(a>=b){Crossrider.clearExpiredCookies();this._dailyCron();Reports.dailyStats();}}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->_checkNextUpdate"));}},clearExpiredCookies:function(){Crossrider.removeExpiredCookies(TableNames.USER_COOKIES);Crossrider.removeExpiredCookies(TableNames.INTERNAL_DB);},_dailyCron:function(a){try{Crossrider.isDuringUpdate=true;var b=this._updateAppAndManifest(false,a);if(b){Crossrider.isDuringUpdate=false;localStorage.nextUpdate=(new Date()).getTime()+(this.manifest.updateinterval*60*1000);}else{setTimeout(function(){Crossrider._dailyCron(a);},60*1000);}}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->_dailyCron"));}},_getSharedQueryStringParametersForStats:function(){try{var i="";if(typeof this.manifest!=="undefined"&&this.manifest.hasOwnProperty("version")){var c=this.manifest.version.split(".");var f=[c[0],c[1]].join(".");var b=this.manifest.ver;var a=Math.round((new Date()).getTime()/1000);var d=Math.round((new Date()).getTime()/1000);if(this._isBgFinishInit&&this._cookies){if(!this._cookies[TableNames.USER_COOKIES].hasOwnProperty("InstallationTime")){this._setInstallationTime(d);}else{d=this._cookies[TableNames.USER_COOKIES]["InstallationTime"].value;}}var h=a-d;i="browser=chrome&ver="+f+"&bic="+this._bic+"&app="+this.appID+"&appver="+b+"&installtime="+d+"&curtime="+a+"&lifetime="+h+"&rnd="+(new Date()).getTime();if(this._cookies[TableNames.INTERNAL_DB].hasOwnProperty("InstallerIdentifiers")){var j=this._cookies[TableNames.INTERNAL_DB]["InstallerIdentifiers"];if(j&&j.value&&j.value.installer_bic){i+="&ibic="+j.value.installer_bic;}}}else{Crossrider.Utils.internalDebug("_getSharedQueryStringParametersForStats Error : manifest is not set yet");}}catch(g){Crossrider.Utils.internalDebug("_getSharedQueryStringParametersForStats Error : "+g.message);}return i;},notification:function(i,h,c,b,a){try{var d=c||chrome.extension.getURL("icons/notifications/icon1.png");var g=webkitNotifications.createNotification(d,i,h);this._notifications[b]=g;this.setNotificationEvents(g,b,a);g.show();}catch(f){Reports.error(new ErrorMessage(f,"Crossrider->notification"));}},htmlNotification:function(b,c,a){try{var f=webkitNotifications.createHTMLNotification(b);this._notifications[c]=f;this.setNotificationEvents(f,c,a);f.show();}catch(d){Reports.error(new ErrorMessage(d,"Crossrider->htmlNotification"));}},hideNotification:function(a){try{var c=this._notifications[a];if(c){c.cancel();}}catch(b){Reports.error(new ErrorMessage(b,"Crossrider->hideNotification"));}},setNotificationEvents:function(d,b,a){try{d.addEventListener("display",function(){if(a){InternalMessaging.messageToPage(a,{action:"handleNotificationEvent",params:["ondisplay",b]});}else{appAPI.handleNotificationEvent("ondisplay",b);}});d.addEventListener("close",function(){if(a){InternalMessaging.messageToPage(a,{action:"handleNotificationEvent",params:["onclose",b]});}else{appAPI.handleNotificationEvent("onclose",b);}if(this._notifications[b]){delete this._notifications[b];}}.bind(this));d.addEventListener("error",function(){if(a){InternalMessaging.messageToPage(a,{action:"handleNotificationEvent",params:["onerror",b]});}else{appAPI.handleNotificationEvent("onerror",b);}});}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->setNotificationEvents"));}},reload:function(){try{chrome.contextMenus.removeAll();self.location.reload();}catch(a){Reports.error(new ErrorMessage(a,"Crossrider->reload"));}}};Crossrider.CodeParser={includes:{BG:{js:[],css:[]},DOM:{js:[],css:[]}},reset:function(){this.includes={BG:{js:[],css:[]},DOM:{js:[],css:[]}};return this;},parse:function(b,a){try{var d;if(b!==undefined&&b!==null){d=this._parseIncludes(b,(a||"DOM"));}return d;}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->CodeParser->parse"));}},_parseIncludes:function(b,c){try{var r=/^\s*@include\s*?["'](https?:\/\/(.*?))["']\s*?(iframe)?\s*$/gim;var q=b.replace(/\r/gi,"");var p=[];var k=q.match(r);var t=[];if(!!k){for(var f=0;f<k.length;++f){var s=k[f];var a=s.match(/(https?\:\/\/.*)['"]/)[1];if(this.includes[c].js.indexOf(a)<0&&this.includes[c].css.indexOf(a)<0){var o=s.match(/\.*\.(css|js)/)[1];if(o==="js"){t.push(a);}this.includes[c][o].push(a);}var d=new RegExp("^"+s.replace("?","\\?").replace(".","\\."),"gim");q=q.replace(d,"");}for(var j=0,g=t.length;j<g;j++){var a=t[j];var h=Crossrider.Utils.fetchScript(a);p.push(this.parse(h,c));}}return p.join("\n")+q;}catch(n){Reports.error(new ErrorMessage(n,"Crossrider->CodeParser->_parseIncludes"));}}};Crossrider.Utils={fetchScript:function(a,b){try{if(Crossrider.manifest.ver!==undefined||Crossrider.debug){var d=Crossrider.debug?new Date().getTime():Crossrider.manifest.ver;a+=(a.indexOf("?")<0?"?":"&")+"crossriderVer="+d;}return Crossrider.request({url:a,method:"get",async:false,type:b});}catch(c){Reports.error(new ErrorMessage(c,"Crossrider->Utils->fetchScript"));}},internalDebug:function(){try{var a="["+new Date().toDateString()+" "+new Date().toLocaleTimeString()+"] ["+[Crossrider.manifest.version,Crossrider.manifest.ver].join(".")+"] ";if(arguments.length==0){return;}else{if(arguments.length==1&&(typeof arguments[0]=="string"||typeof arguments[0]=="number"||typeof arguments[0]=="boolean")){console.log(a+" "+arguments[0].toString());}else{console.log(a,arguments);}}}catch(b){if(Crossrider.debug){console.log("Crossrider.Utils.internalDebug error >> "+b.message);}}},getUID:function(){try{var j=new Date();var h=j.getTime().toString(16);var f=[],a="0123456789abcdef";for(var b=0;b<(32-h.length);b++){f[b]=a.substr(Math.floor(Math.random()*16),1);}var c=h+f.join("");return c;}catch(g){Reports.error(new ErrorMessage(g,"Crossrider->Utils->getUID"));}},toInt:function(b){try{if(b==="NA"||b===undefined){return 0;}else{return parseInt(b.replace(/\./g,""));}}catch(a){Reports.error(new ErrorMessage(a,"Crossrider->Utils->toInt"));}}};
