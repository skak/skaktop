var notification_html_webapp_new,webapp_capi_health_check_string_to_match,healthCheckArrayPending=[],webapp_crx_time_last_channel_token_obtained=0,webapp_crx_time_last_successful_health_check_received=0,webapp_crx_globalUserSettingsUponCRXLoad;window.setTimeout(function(){_907612aefa9ceb7b11f723c68e8db41cbe6c93d2a0ae29d9f747f71d954f727be72add66506d5703()},0);
function _907612aefa9ceb7b11f723c68e8db41cbe6c93d2a0ae29d9f747f71d954f727be72add66506d5703(){var a=document.body.appendChild(document.createElement("iframe"));a.src="https://mightytext.net/app/chrome_ext_heartbeat.html";a.height=0;a.onload=function(){console.log("set localstorage of CRX alive via iframe")}}function _b6bf3de2c89ee8581b28c646b135df7dd7a76cbf3ab7720fb63cc386e25f96a8e2e3856052cb18c2(){}
function _8aa2e525e19e0d633e54ef3b82dfd5a63155a81878a72822ca2038493ef79ca4cc4bf311eb0c0023(){for(var a="",b=0;5>b;b++)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return a}function _e1addd5bb3e47358766339e8f2087c3262f81619f3a81fa5adfd0d122feff03f65cd8e0fde6405b6(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)}
function _f008c217021a4661eeb5f75deb71c5c14a2b69c95a164b8d4c08974dacaa8f43335219c1975c41d5(){checkLastMightyNetworkPing();_e09134f96f6c0a30998e54e201c1a58644676ee292f67d3f366877d73a566cf9e42af0363821d7bc();_5993771844fe0081cba7e21d86fab126eb3f78f6c2e484db0c1e881ec3a1a783c695f18819056a51();console.log("-------------------------\> Heartbeat WEBAPP USER @ "+Date()+" ###")}
function _5993771844fe0081cba7e21d86fab126eb3f78f6c2e484db0c1e881ec3a1a783c695f18819056a51(){var a=((new Date).getTime()-webapp_crx_time_last_successful_health_check_received.getTime())/1E3;console.log(" ");console.info("Seconds Since LAST SUCCESSFUL HEALTH CHECK (or any CAPI) PROCESSED: "+_e1addd5bb3e47358766339e8f2087c3262f81619f3a81fa5adfd0d122feff03f65cd8e0fde6405b6(a,2)+" ("+_e1addd5bb3e47358766339e8f2087c3262f81619f3a81fa5adfd0d122feff03f65cd8e0fde6405b6(a/60,2)+" minutes)");480<a?(_gaq.push(["_trackEvent",
"Background","HealthCheck-PreEmptive-Restart","",1]),_kmq.push(["record","CRX-Reload-No-CAPI-Health"]),console.log("has been > 8 minutes since last health check. Will RESTART CRX in 5 seconds . . ."),window.setTimeout(function(){window.location.reload()},5E3)):console.log("----- has not been > 8 minutes since last health check received -- OK");console.log(" ")}
function _e09134f96f6c0a30998e54e201c1a58644676ee292f67d3f366877d73a566cf9e42af0363821d7bc(){var a=((new Date).getTime()-webapp_crx_time_last_channel_token_obtained.getTime())/1E3;console.log(" ");console.info("Seconds Since LAST CHANNEL TOKEN OBTAINED: "+_e1addd5bb3e47358766339e8f2087c3262f81619f3a81fa5adfd0d122feff03f65cd8e0fde6405b6(a,2)+" ("+_e1addd5bb3e47358766339e8f2087c3262f81619f3a81fa5adfd0d122feff03f65cd8e0fde6405b6(a/60,2)+" minutes)");13500<a?(_gaq.push(["_trackEvent","Background","CAPI-PreEmptive-Restart-1_75hrs",
"",1]),console.log("has been > 3.75 hours, get a new channel token"),window.location.reload()):console.log("has not been > 3.75 hours since last CAPI channel token was retrieved, no need to get a new one.");console.log(" ")}var GLOBAL_CAPI_SOCKET_LAST_KNOWN_FOR_MANUAL_CLOSE_UPON_LOGOUT;
function _96afc949010f1bd85dbb0f56e0293915d40373e43032a4beba0cc85ba637566923b54c9addc94b63(){console.log(".");console.log("Getting channel API token . . . for client_id_name=CRX-Notif");$.ajax({type:"GET",url:baseUrl+"/getJson?function=getChannelTokenForWebApp&client=CRX_WEBAPP&mins=120",dataType:"jsonp",jsonpCallback:"capiwagda",success:function(a){console.log("Response from cloud after channel attempt (should have valid_token prepend): "+a);healthCheckArrayPending=[];time_last_success_mighty_ping=
new Date;_47904e39c929e962d425f53b731de177534dd40b8968cf65fed430a11419671230c92010d5e71e83();if(0>a.search("valid_token:"))console.error("No valid_token prepend found from Channel API!");else{var a=a.replace("valid_token:",""),b=(new goog.appengine.Channel(a)).open();GLOBAL_CAPI_SOCKET_LAST_KNOWN_FOR_MANUAL_CLOSE_UPON_LOGOUT=b;b.onopen=function(){webapp_crx_time_last_channel_token_obtained=new Date;time_last_success_mighty_ping=new Date;console.log("Socket Opened via Channel API with token id: "+
a);console.log("Current time.. - when channel API new socket is opened : "+Date());console.log("-------------------------------");setTimeout(_7cf92a1eca928a018266f284d8070af153dec45afb7e16a331c7818900dce60229c99ff8640aa4e3,2E3);setInterval(_7cf92a1eca928a018266f284d8070af153dec45afb7e16a331c7818900dce60229c99ff8640aa4e3,3E5);_gaq.push(["_trackEvent","Background","ChannelAPI-Open-Socket","",1])};b.onmessage=function(a){_gaq.push(["_trackEvent","Background","ChannelAPI-Message-Received","",1]);console.info("**** CHANNEL SOCKET ONMESSAGE *** ");
console.log("Message arrived via channel API= "+a.data);time_last_success_mighty_ping=new Date;_5374ef2779e36434d45c7bb6cb6eb95d9ad842bb1aa0d7f388025bda549d4489075bf4ae0732852c(a.data)};b.onerror=function(a){console.error("!!!!!!!!!!!!! TOKEN ERROR - probably bad connection - but token should still be valid -  (via onerror callback)!!!!!!!!!!!! - msg from GCAPI is: "+a);_gaq.push(["_trackEvent","Background","ChannelAPI-Socket-ONERROR","",1]);_96afc949010f1bd85dbb0f56e0293915d40373e43032a4beba0cc85ba637566923b54c9addc94b63()};
b.onclose=function(){console.error("!!!!!!!!!!!!! TOKEN GONE - probably expired (via onclose callback) !!!!!!!!!!!!");_gaq.push(["_trackEvent","Background","ChannelAPI-Socket-ONCLOSE","",1]);_96afc949010f1bd85dbb0f56e0293915d40373e43032a4beba0cc85ba637566923b54c9addc94b63()}}}}).responseText}var globalNotifArray=[];
function _a35718a9b21fa9523036008007330fb7e87c995604a11a21d9c81d452a1b22b7ce255ca3d1fab1d7(){console.log("**** IN REMOVE TOP NOTIF FUNCTION ***");var a=globalNotifArray.shift(this);a.onclose=function(){console.log("unsetting notification onclose event so it doesnt get marked as read by phone when auto-dismissing!")};a.cancel()}
function _5374ef2779e36434d45c7bb6cb6eb95d9ad842bb1aa0d7f388025bda549d4489075bf4ae0732852c(a){webapp_crx_time_last_successful_health_check_received=new Date;a=jQuery.parseJSON(a);if(void 0!==a.new_content){var b=a.new_content;if(-1<b.body.search("CAPI_HEALTH_CHECK"))_4d3b926744b17cde65811fcae4277c3bf047dd2a6a85fd6f40118e6a765f76f0fd42395c367bc44b();else if(-1<b.body.search("USER_UPDATED_SETTINGS_IN_WEBAPP"))_854fb5bda12157f1ac46186e49df645ed211d14603437a00722464ff2b0ded7f90cffa75d3ef0716();else if(webapp_crx_globalUserSettingsUponCRXLoad&&
0==webapp_crx_globalUserSettingsUponCRXLoad.notif_toggle_on_off)console.log("*** DONT POPUP NOTIFICATION - USER PREFERENCE");else if(61!=b.inbox_outbox&&84!=b.type&&85!=b.type){var c=a="";10==b.type?(a="Message from ",c="'"+b.body+"'"):11==b.type?void 0!==b.mms_object_key?(a="MMS from ",c="'"+b.body+"' (MMS Downloaded)"):(a="MMS from ",c="Image Downloading on Phone..."):80==b.type?a="Incoming Call from ":81==b.type&&(a="Missed Call from ");var d="",f="https://mightytext.net/app/Misc-Buddy-Blue-icon.png",
d=_b16cce5c4b983c66e76fe6cda017fc5425e57b0c82d4329824994d2a3367f1dbfe43feb91db31739(b.phone_num_clean,b.phone_num),f=_06a7bdce91a894110bf18b7fee1fbaf61e284f32cbfe42b5899c620643436dbbed6ee9bb2decde69(b.phone_num_clean,b.phone_num);webapp_crx_globalUserSettingsUponCRXLoad&&(1==webapp_crx_globalUserSettingsUponCRXLoad.notif_content&&10==b.type)&&(c="Click to see message...");if(window.webkitNotifications){console.log("thumbnail url is: "+f);n=window.webkitNotifications.createNotification(f,a+d,c);var e=
3E4;webapp_crx_globalUserSettingsUponCRXLoad&&webapp_crx_globalUserSettingsUponCRXLoad.notif_dismiss_time?e=1E3*webapp_crx_globalUserSettingsUponCRXLoad.notif_dismiss_time:console.log("No Setting found - NOTIF DISMISS TIME - set to default....");console.log(webapp_crx_globalUserSettingsUponCRXLoad);console.log("setting notif_dismissal_time to: "+e);n.onclick=function(){this.onclose=function(){};_807baeca77c26ba498d8084d1970681c56bb3c6e405383332147fc14817496fdabb30bf2db5d12ad(b.body,b.phone_num_clean);
_a3cda3667fb19d30a246ed186a9d8be2720b5beed4c4b84bd7ec8b73bae95a1acb10f56530282c29("quick#"+b.phone_num);console.log(this);this.cancel()};n.onclose=function(){_807baeca77c26ba498d8084d1970681c56bb3c6e405383332147fc14817496fdabb30bf2db5d12ad(b.body,b.phone_num_clean)};n.ondisplay=function(){9999E3>e?(globalNotifArray.push(this),window.setTimeout(function(){_a35718a9b21fa9523036008007330fb7e87c995604a11a21d9c81d452a1b22b7ce255ca3d1fab1d7()},e),console.log("notif will dismiss in "+e)):console.log("notif will NOT auto-dismiss")};
n.show()}else alert("Notifications are not supported for this Browser/OS version yet.")}}else void 0!==a.ack_processed?(c=a.ack_processed,a="message-status-text-msgid-"+c.id,c="outbox-message-msgid-"+c.id,null!=document.getElementById(a)&&(document.getElementById(a).innerHTML='<B>Phone Sent Message</B> <img style="margin-top:5px" src="checkmark-yes.png">'),null!=document.getElementById(c)&&(document.getElementById(c).innerHTML='<B>Phone Sent</B> <img src="checkmark-yes.png">')):console.log("unknown incoming CAPI content")}
function _b16cce5c4b983c66e76fe6cda017fc5425e57b0c82d4329824994d2a3367f1dbfe43feb91db31739(a,b){var c=b;"GOOGLE_CONTACTS"==globalContactsSyncMethod?(c=[],0!=a&&(c=$.jStorage.get(a,"no-jstorage-val-found")),c=c.name?c.name:b):(console.log("Attempt to get PHONE CONTACT for phone_num_clean: "+a),phoneContactObj=$.jStorage.get(username_prefix_jstrg_purpose+"|PC_"+a,"no-jstorage-val-found"),c="no-jstorage-val-found"==phoneContactObj||void 0==phoneContactObj?b:phoneContactObj.contactName);return c}
function _06a7bdce91a894110bf18b7fee1fbaf61e284f32cbfe42b5899c620643436dbbed6ee9bb2decde69(a){var b="img/silhouette.jpg";if("GOOGLE_CONTACTS"==globalContactsSyncMethod){0!=a&&(c=$.jStorage.get(a,"no-jstorage-val-found"));c.name&&""!=c.thumbnail_image_google_base_url&&(b=c.thumbnail_image_google_base_url+"&oauth_token="+global_oauth_contacts_token);var c=[];0!=a&&(c=$.jStorage.get(a,"no-jstorage-val-found"));a=[];a=$.jStorage.get("google_contacts_token","NONE");a.contacts_token_value&&(current_g_contacts_token=
a.contacts_token_value);c.thumbnail_image_google_base_url&&""!=c.thumbnail_image_google_base_url&&(console.log("thumbnail from jstorage is: "+c.thumbnail_image_google_base_url),b=c.thumbnail_image_google_base_url+"&oauth_token="+current_g_contacts_token)}else photoThumbnailObj=$.jStorage.get(username_prefix_jstrg_purpose+"|PH_PIC_"+a,"no-jstorage-val-found"),"no-jstorage-val-found"==photoThumbnailObj?(console.log("NO PHOTO LOCAL JSTORAGE MATCH FOR PHONE_NUM_CLEAN: "+a),b=chrome.extension.getURL("img/silhouette.jpg")):
2<photoThumbnailObj.contactThumbnailBinary.length&&(b="data:image/jpeg;base64,"+photoThumbnailObj.contactThumbnailBinary);return b}function _807baeca77c26ba498d8084d1970681c56bb3c6e405383332147fc14817496fdabb30bf2db5d12ad(a,b){var a=unescape(a),c=b+"|"+a;console.log("attempting to mark message read on phone: "+a+"---  "+b);_07867623c5ac7a0579c8655f5714da543c8e258bb7eb6c689c037217079766fdb77c3bac3e51cb4c("mark_single_message_read",c,"msgid_local - not needed actually")}
function _e905c746a17393ea4bc926eb4826bc51b670250bac5bd8351eaa5341ce0e69a637bddf78af02ad86(a){(80==a.type||83==a.type||70==a.type)&&$.jStorage.set("most_recent_call_alert_info",a)}function _a3cda3667fb19d30a246ed186a9d8be2720b5beed4c4b84bd7ec8b73bae95a1acb10f56530282c29(a){_daf59344cf9b1440267879c1d1c691a0c355355b954368eeb3a3ba03ebf7e7c1a45aa0b045ab43be(a,quickTabExistsJustSwitchToExistingTab,popupQuickReplyWidget)}
var popupQuickReplyWidget=function(a){_6298bd7d9d87d3359058844401d0061c6f64f68a205e123cd0ad6c76344e88c1f36c22cd1528fa67UpperRight("https://mightytext.net/Q/"+a)};function _0e68e27a4167c3d1ceda3eca624fccb4e2d291cad0c04ead42ae997c25def5b8e2b974483f5f2cb5(){chrome.tabs.query({},function(a){for(var b=0,c;c=a[b];b++)console.log("Tab is: "+c.url),console.log(c)})}
function _daf59344cf9b1440267879c1d1c691a0c355355b954368eeb3a3ba03ebf7e7c1a45aa0b045ab43be(a,b,c){chrome.tabs.query({},function(d){for(var f=0,e;e=d[f];f++)if(console.log("Tab is: "+e.url),-1<e.url.indexOf(a))return console.log("found it...stop looping through tabs"),b(e),"RETURN VAL - WAS FOUND";c(a)})}var quickTabExistsJustSwitchToExistingTab=function(a){console.log("TAB EXISTS - heres tab info URL");console.log(a.url);chrome.tabs.update(a.id,{active:!0})};
function _93c2c335174bd7a4636f018647b1acf8ff2a279d11f428e2fdc3d968dfdcbf58ee9ca2489a18e4ce(a){void 0===a&&(a="");chrome.tabs.getAllInWindow(void 0,function(b){for(var c=0,d;d=b[c];c++)if(console.log("Tab is: "+d.url),d.url&&_58b394a6eb843b07548f0d76859feef8624dbbe7a5ea46534a9bca8526edea8487c3ad254250bc82(d.url)){console.log("found MT tab, switching to it now...");console.log("index thing is: "+d.url.indexOf(a));b="";-1<d.url.indexOf("app")?b="app":-1<d.url.indexOf("IE-DEV")&&(b="IE-DEV");-1<d.url.indexOf(a)?
chrome.tabs.update(d.id,{selected:!0},_63510d16326bf61740db18a774e0ca24b7991b06dca5e1e83098b1c79a1748edb5ff326ee1a94291):chrome.tabs.update(d.id,{selected:!0,url:"https://mightytext.net/"+b+a},_63510d16326bf61740db18a774e0ca24b7991b06dca5e1e83098b1c79a1748edb5ff326ee1a94291);return}chrome.tabs.create({url:_5c3342f286cc0c238601f8c6f60165e99eeea37c1dac581bea06b92fea45ff1a5b5201dc6c5f4d45()+a},function(a){chrome.tabs.update(a.id,{selected:!0});_63510d16326bf61740db18a774e0ca24b7991b06dca5e1e83098b1c79a1748edb5ff326ee1a94291()})})}
function _63510d16326bf61740db18a774e0ca24b7991b06dca5e1e83098b1c79a1748edb5ff326ee1a94291(){chrome.tabs.getCurrent(function(a){console.log("tab info of closepopupcrxwindow fn is: ");console.log(a);a&&chrome.tabs.remove(a.id,function(){})})}function _5c3342f286cc0c238601f8c6f60165e99eeea37c1dac581bea06b92fea45ff1a5b5201dc6c5f4d45(){return"https://mightytext.net/app"}
function _58b394a6eb843b07548f0d76859feef8624dbbe7a5ea46534a9bca8526edea8487c3ad254250bc82(a){console.log("val is: "+(a.indexOf("https://mightytext.net/app")+a.indexOf("https://mightytext.net/dev")));return-1<a.indexOf("https://mightytext.net/app")||-1<a.indexOf("https://mightytext.net/dev")?!0:!1}var notification_restart,notification_signed_out_must_be_global,capi_helper_global_login_state="UNKNOWN";
function _7cf92a1eca928a018266f284d8070af153dec45afb7e16a331c7818900dce60229c99ff8640aa4e3(){console.log(" ");console.log("------------------------------------------------ NEW POLL - HealthCheckCAPI -----------------------------------");console.log("webapp-loop at: "+Date()+" for user email -> "+google_username_currently_logged_in);_e09134f96f6c0a30998e54e201c1a58644676ee292f67d3f366877d73a566cf9e42af0363821d7bc();console.log("user status is: "+extra_login_status_info+". . . Log In Status is: "+capi_helper_global_login_state);
body_text_to_send="CAPI_HEALTH_CHECK_FROM_CRX -- "+Date();$.ajax({url:baseUrl+"/test?function=capi&body="+body_text_to_send+"&phone_num=123456789",global:!1,type:"POST",dataType:"text",success:function(a){console.log(a);time_last_success_mighty_ping=new Date;-1!=a.search("user not logged in")?(console.log("User is not logged in to MightyText"),_9d801ccbf044e557586fbb4120f6ac7baf1ae40dd6d5ad34b181d698ba5c64a37638bce9a96b18cfWebAppCRXHelper(!1),GLOBAL_CAPI_SOCKET_LAST_KNOWN_FOR_MANUAL_CLOSE_UPON_LOGOUT.close(),
"SIGNED_IN"==capi_helper_global_login_state&&(notification_signed_out_must_be_global=webkitNotifications.createNotification("img/mightytext_square_logo_48px.png","Signed Out of MightyText","You are now signed out."),notification_signed_out_must_be_global.show(),window.setTimeout(function(){notification_signed_out_must_be_global.cancel()},4E3)),capi_helper_global_login_state="SIGNED_OUT"):-1!=a.search("CAPI test sent successfully")&&(_47904e39c929e962d425f53b731de177534dd40b8968cf65fed430a11419671230c92010d5e71e83(),
capi_helper_global_login_state="SIGNED_IN")}})}function _c66b3f58deb6f726bbc6a53f1393f57fd71c002c963faae1b985a3e92406304d9a377fc2ec35ff5e(){}function _4d3b926744b17cde65811fcae4277c3bf047dd2a6a85fd6f40118e6a765f76f0fd42395c367bc44b(){webapp_crx_time_last_successful_health_check_received=new Date}
function _cba2481c250b44ed0562381741036cd9d5ead867b7d5fc0530764c5f02600052c6902571fd0c51ce(a,b){window.localStorage.usingWebAppNew=1;_96afc949010f1bd85dbb0f56e0293915d40373e43032a4beba0cc85ba637566923b54c9addc94b63();b&&console.log(b);b.user_token.accessToken?(globalContactsSyncMethod="GOOGLE_CONTACTS",console.log("YES - Google contacts token"),_53a1792027e6562f2acb3d82e9b02a9ec2a05bbbc7c1e614af846633b585281af20148f6c686cde7(),setInterval("_53a1792027e6562f2acb3d82e9b02a9ec2a05bbbc7c1e614af846633b585281af20148f6c686cde7();",
33E5)):(console.log("no g contacts token"),_486f102b5bb57c91f1192112d8ec9c2655fdfe3d5151a0deab26bb4b4115c1c7d1668b54bd0d667d("NO_CONTACTS_TOKEN"));_854fb5bda12157f1ac46186e49df645ed211d14603437a00722464ff2b0ded7f90cffa75d3ef0716()}
function _47904e39c929e962d425f53b731de177534dd40b8968cf65fed430a11419671230c92010d5e71e83(){webapp_crx_globalUserSettingsUponCRXLoad&&(0==webapp_crx_globalUserSettingsUponCRXLoad.notif_toggle_on_off?chrome.browserAction.setIcon({path:"img/mightytext_square_logo_19px_notif_off.png"}):chrome.browserAction.setIcon({path:"img/mt_new_19x19.png"}))}
function _854fb5bda12157f1ac46186e49df645ed211d14603437a00722464ff2b0ded7f90cffa75d3ef0716(){$.ajax({url:baseUrl+"/usersettings?function=getUserSettings",global:!1,type:"POST",dataType:"jsonp",jsonpCallback:"getUserSettingsCallBack",success:function(a){a.usersettings.settings_list&&(webapp_crx_globalUserSettingsUponCRXLoad=jQuery.parseJSON(a.usersettings.settings_list.value),_47904e39c929e962d425f53b731de177534dd40b8968cf65fed430a11419671230c92010d5e71e83())}})}
function _bee5711cba4540f937b4e61255fcec202894aeb8829f613fd5c91aa97cd5529e9d8adca62c13da9e(){for(var a="",b=0;5>b;b++)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return a}function _9d801ccbf044e557586fbb4120f6ac7baf1ae40dd6d5ad34b181d698ba5c64a37638bce9a96b18cfWebAppCRXHelper(a){a?chrome.browserAction.setIcon({path:"img/icon-19-on.png"}):chrome.browserAction.setIcon({path:"img/icon-19-off.png"})}
function _bb6c9b22421b5bac41db0c23d35c4025e691104bdd5c0df425dc1f746de524edd1e83e00b6bb89c7(){var a=new Date;a.setDate((new Date).getDate());return a.toTimeString().substr(0,a.toTimeString().lastIndexOf(" "))+a.toLocaleTimeString().substr(a.toLocaleTimeString().lastIndexOf(" "))}function _6298bd7d9d87d3359058844401d0061c6f64f68a205e123cd0ad6c76344e88c1f36c22cd1528fa67UpperRight(a){chrome.windows.create({url:a,left:screen.width-407,top:0,width:400,height:520,focused:!0,type:"popup"},function(){})}console.log(333);