function _b4a3df8bbcac42b62ab5f56de43c69fc522dbc887e3b1e0f406e11c600ced009d8a357fc5aa57da8Orig(){oauth.authorize(function(){_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("on google contacts - oauth.authorize()");oauth.sendSignedRequest("http://www.google.com/m8/feeds/contacts/default/full",_eb37f38824bc114a1b286095ed313ce54faa0bbb5ec475005d2a5e68419080231b038c154aefaeed,{parameters:{alt:"json","max-results":1E4}})})}
function _db46c242d0c56255ee7161d045a25defd5cde0b71c59d83cac42633893e3fb2244ebe92d24a2dfc1(){console.log("NON-WEBAPP-HEARTBEAT-CHECK");console.log("Current polling frequency is: "+poll_freq);checkLastMightyNetworkPing()}console.log("----------------- Starting Background Script ** -----------");var globalHeartbeatInterval=setInterval(_db46c242d0c56255ee7161d045a25defd5cde0b71c59d83cac42633893e3fb2244ebe92d24a2dfc1,1E4);_gaq.push(["_trackEvent","Background","Startup-BG-Script","",1]);
var token,time_last_channel_token_obtained=0,time_last_success_mighty_ping=new Date,globalContactsSyncMethod="SYNC_PHONE",username_prefix_jstrg_purpose,calling_from_chrome_extension=!0,capi_rollout_factor=2.8;console.log("capi rollout factor is "+capi_rollout_factor);
var GOOGLE_CONTACTS_OAUTH_STATUS="UNKNOWN",oauth=ChromeExOAuth.initBackgroundPage({request_url:"https://www.google.com/accounts/OAuthGetRequestToken",authorize_url:"https://www.google.com/accounts/OAuthAuthorizeToken",access_url:"https://www.google.com/accounts/OAuthGetAccessToken",consumer_key:"anonymous",consumer_secret:"anonymous",scope:"http://www.google.com/m8/feeds/",app_name:"MightyText - Contacts Sync"}),contacts_bkg_page=null,contacts_autocomplete_per_unique_phone_num=null,num_consecutive_internet_connection_failures=
0,notify_android_app_install_once=!1,debug_mode=1;_9d801ccbf044e557586fbb4120f6ac7baf1ae40dd6d5ad34b181d698ba5c64a37638bce9a96b18cf(!1);var google_login_status=!1,google_username_currently_logged_in="",login_and_beta_ready=!1,extra_login_status_info="";_e60fa69eab2e00210364bd47e24d4122747965d0995e75919884158cc653a8bff140b3d8d9b7f890();var GOOGLE_CONTACTS_OAUTH_STATUS="UNKNOWN",should_get_contacts_token_in_new_tab=!0;
_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Google Contacts Token Status: "+GOOGLE_CONTACTS_OAUTH_STATUS);function _e60fa69eab2e00210364bd47e24d4122747965d0995e75919884158cc653a8bff140b3d8d9b7f890(){setTimeout(_a1d41efe36109a1f60cd75c09a94740ea3707438e45b3d89a09ec341475f9f4811d73d7f035832ba,300)}
function _eb37f38824bc114a1b286095ed313ce54faa0bbb5ec475005d2a5e68419080231b038c154aefaeed(b){contacts_bkg_page=[];contacts_autocomplete_per_unique_phone_num=[];for(var b=JSON.parse(b),a=0,c;c=b.feed.entry[a];a++){var d={name:c.title.$t,id:c.id.$t,emails:[],phonenums:[]},h={label:c.title.$t,value:""};if(c.gd$email)for(var g=c.gd$email,f=0,e;e=g[f];f++)d.emails.push(e.address);d.name||(d.name=d.emails[0]||"<Unknown>");if(c.gd$phoneNumber){g=c.gd$phoneNumber;for(f=0;f<g.length;f++)e=g[f],d.phonenums.push(e.$t),
h.label=d.name+" "+e.$t,h.value=e.$t,contacts_autocomplete_per_unique_phone_num.push({label:d.name+" "+e.$t,value:e.$t})}c.gd$phoneNumber&&contacts_bkg_page.push(d)}}function _be8ee0f637d29931cfeeee1cb1361eb70f710263a3cd9fb982c5341aec7e54a91daee19403071679GoogleOpenID(){oauth.clearTokens();_9d801ccbf044e557586fbb4120f6ac7baf1ae40dd6d5ad34b181d698ba5c64a37638bce9a96b18cf(!1)}var msgcount="",simplevalidation="",db,msgcount2="",msgList="",PendingSMSArray=[];
chrome.extension.onRequest.addListener(function(b,a,c){_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02(a.tab?"from a content script:"+a.tab.url:"from the extension");"user_invoked_popup_so_force_google_login_check"==b.purpose&&(console.log("* User Clicked Popup icon in extension**  Now check if a webapp user?"),"WEBAPP_BETA"==extra_login_status_info?console.log("YES - user is a web app user. Don't do anything extra (dont call checkGoogleLoginTokenAndSetUsername)"):
(console.log("NO - user is legacy CRX user."),_a1d41efe36109a1f60cd75c09a94740ea3707438e45b3d89a09ec341475f9f4811d73d7f035832ba()),c({reply:"success"}))});
chrome.extension.onRequest.addListener(function(b,a,c){_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02(a.tab?"from a content script:"+a.tab.url:"from the extension");"call_from_popup_to_check_contact_info"==b.greeting&&(should_get_contacts_token_in_new_tab=!1,_b4a3df8bbcac42b62ab5f56de43c69fc522dbc887e3b1e0f406e11c600ced009d8a357fc5aa57da8(),c({farewell:contacts_bkg_page,autocomplete_contacts_list:contacts_autocomplete_per_unique_phone_num,google_contacts_token_status:GOOGLE_CONTACTS_OAUTH_STATUS}))});
chrome.extension.onRequest.addListener(function(b,a,c){_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02(a.tab?"from a content script:"+a.tab.url:"from the extension");"get_new_g_contacts_token_call_from_popup"==b.purpose&&(should_get_contacts_token_in_new_tab=!0,_b4a3df8bbcac42b62ab5f56de43c69fc522dbc887e3b1e0f406e11c600ced009d8a357fc5aa57da8Orig(),c({myreply:"yo yo"}))});
chrome.extension.onRequest.addListener(function(b,a,c){_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02(a.tab?"from a content script:"+a.tab.url:"from the extension");"popup_checking_current_google_login_state"==b.purpose&&c({google_login_status_from_bg_page:google_login_status,login_and_beta_ready_from_bg_page:login_and_beta_ready,google_username_currently_logged_in_from_bg_page:google_username_currently_logged_in,extra_login_status_info_from_bg_page:extra_login_status_info})});
chrome.extension.onRequest.addListener(function(b,a,c){_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02(a.tab?"from a content script:"+a.tab.url:"from the extension");"set_quick_polling_outbound_message"==b.purpose&&(_24b155fee6fbc306a626390e3c06560a7a7c7900aec39f8e95a69ee981718b192cf881d00c4f9f12("Outbound Message being sent, lower polling to check for ACK faster",2E3),c({myreply:"sent request to set polling to 2000"}))});
function _39ddea6aa3ff0c82f010975424b25bb0b658b83b4ce97040cc6d94438fa8dd736cf752254995ef96(){}function _2ae48794ecd83050e0cb719955dd97d8f3d8d17bd6db9569512abe816506240a4da34c360b7b334f(b,a){log.innerHTML+="<p>"+a.message+"</p>"}function OLD__1f1b0ab71d1094b32f80a4658347be63939f761f2e8ba07a3d228e38028339db0131b8b29f0907da(b,a){_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Error during SQL insert: "+a.msg)}
var default_poll_freq=17E3,highest_poll_freq=7E4,poll_freq=default_poll_freq,consecutive_polls_without_message_activity=0,total_aggregate_polls=0,poll_state="START";db=openDatabase("Texty","1.0","Texty-SMS",2E5);localStorage.isInitialized||(localStorage.isActivated=!0,localStorage.frequency=1,localStorage.isInitialized=!0);_9c477210d23ffe19a98e84cd79e7804fe7e02b5e7966f05d5ba5bdccbdf07eb0c2d946d9affcc6ad();
if(webkitNotifications){var interval=0,currentGlobalIntervalID=setInterval(_7432e47fa118031fc8c9c4e60c8fa5da4c236186c833ec213b96322519399431368e7b899716d665,poll_freq);_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("STARTUP --  ** Setting polling to: "+poll_freq)}else chrome.tabs.create({url:"error.html"});
function _7432e47fa118031fc8c9c4e60c8fa5da4c236186c833ec213b96322519399431368e7b899716d665(){interval++;JSON.parse(localStorage.isActivated)&&localStorage.frequency<=interval&&(consecutive_polls_without_message_activity++,total_aggregate_polls++,_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("------------------------------------------------"),_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("At START of POLL at "+Date()),_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Poll State is: "+
poll_state),_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Current polling frequency is: "+poll_freq),_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("# of consecutive polls without activity is: "+consecutive_polls_without_message_activity),_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("TOTAL AGGREGATE POLLS: "+total_aggregate_polls),_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Google Login Status is: "+
google_login_status),4<consecutive_polls_without_message_activity&&"OK-NORMAL"==poll_state&&_24b155fee6fbc306a626390e3c06560a7a7c7900aec39f8e95a69ee981718b192cf881d00c4f9f12("*No new incoming message Activity in a while...increase polling freq...",Math.min(highest_poll_freq,1.05*poll_freq)),!0==google_login_status&&!0==network_connection_status&&!0==login_and_beta_ready?(_43a736b3e9532bc2ec3d7b68d4961fdc2f7c3c1ecf2d42439afa3488174fffa6a4d30c205a094150(),"OK-NORMAL"!=poll_state&&(poll_state="OK-NORMAL",
console.log("stopping this Interval and restarting to default - g user logged in ...setting poll frequency to DEFAULT"),poll_freq=default_poll_freq*capi_rollout_factor,interval=0,clearInterval(currentGlobalIntervalID),window.setInterval(function(){_7432e47fa118031fc8c9c4e60c8fa5da4c236186c833ec213b96322519399431368e7b899716d665()},poll_freq))):(console.log("user not logged in -- reason is "+google_username_currently_logged_in),_a1d41efe36109a1f60cd75c09a94740ea3707438e45b3d89a09ec341475f9f4811d73d7f035832ba(),
_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Network Connection Status: "+network_connection_status),!1==network_connection_status?(poll_state="WAITING-FOR-NETWORK",_24b155fee6fbc306a626390e3c06560a7a7c7900aec39f8e95a69ee981718b192cf881d00c4f9f12("Waiting for Network",2E4)):"WAITING-FOR-USER-PROPER-AUTH"!=poll_state&&(poll_state="WAITING-FOR-USER-PROPER-AUTH",_24b155fee6fbc306a626390e3c06560a7a7c7900aec39f8e95a69ee981718b192cf881d00c4f9f12("Waiting for proper User Auth",
4E4))))}
function _24b155fee6fbc306a626390e3c06560a7a7c7900aec39f8e95a69ee981718b192cf881d00c4f9f12(b,a){console.log(b+"...Stopping this Interval and resetting Polling...setting poll frequency to "+a);poll_freq=a;poll_freq*=capi_rollout_factor;console.log("ACTUALLY setting to "+poll_freq+"...based on CAPI rollout factor of "+capi_rollout_factor);clearInterval(currentGlobalIntervalID);consecutive_polls_without_message_activity=0;currentGlobalIntervalID=window.setInterval(function(){_7432e47fa118031fc8c9c4e60c8fa5da4c236186c833ec213b96322519399431368e7b899716d665()},poll_freq)}
function _43a736b3e9532bc2ec3d7b68d4961fdc2f7c3c1ecf2d42439afa3488174fffa6a4d30c205a094150(){_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Checking MightyText at "+Date());_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("google_login_status is: "+google_login_status);_c302c006f66c9b1240b45741fe0b99acb1789f3926cfd58808847e0440c0457dc33206c2ff8cb510(!0);_3519cdf5e9d4bef92c8881e303897f7c70d92398e0f34ffa3c10d2940937a2d499db16c5e72f5d58()}
function checkLastMightyNetworkPing(){var b=((new Date).getTime()-time_last_success_mighty_ping.getTime())/1E3;_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("--------------\> Seconds Since LAST MightyText network ping: "+b);360<b&&(console.error("---\> has been a long time since last MT ping -- try to contact google.com first"),$.ajax({type:"GET",url:"https://accounts.google.com/latitude/mobile_phone-16.gif",cache:!1,success:function(){console.log("Network ping to Google -- fine...");
_kmq.push(["record","CRX Force Reload No Ping"]);console.log("google login status is true -- will reload CRX BG in 10 seconds");window.setTimeout(function(){window.location.reload()},1E4)}}))}
function _3519cdf5e9d4bef92c8881e303897f7c70d92398e0f34ffa3c10d2940937a2d499db16c5e72f5d58(){if(0==time_last_channel_token_obtained)console.log("no channel opened yet in this session, go open one"),_001eecf574be8e81bbec314c613454c697c9788a890ced7ecc60da9247091c50325fc8c89708a622();else{var b=((new Date).getTime()-time_last_channel_token_obtained.getTime())/1E3;_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Seconds Since LAST CHANNEL TOKEN OBTAINED: "+b);13500<b?
(console.log("has been > 3.75 hours, get a new channel token"),_001eecf574be8e81bbec314c613454c697c9788a890ced7ecc60da9247091c50325fc8c89708a622()):console.log("has NOT been > 3.75 hours since last CAPI channel token was retrieved, no need to get a new one.")}}function _e1addd5bb3e47358766339e8f2087c3262f81619f3a81fa5adfd0d122feff03f65cd8e0fde6405b6(b,a){return Math.round(b*Math.pow(10,a))/Math.pow(10,a)};