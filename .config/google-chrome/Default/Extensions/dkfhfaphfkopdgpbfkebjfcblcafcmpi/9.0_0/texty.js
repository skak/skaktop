var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-21391541-2"]);_gaq.push(["_trackPageview"]);(function(){var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src="https://ssl.google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();var _kmq=_kmq||[],_kmk=_kmk||"a009d9e3633da7d7456e8e1478c8f05f33e35f8e";
function _kms(a){setTimeout(function(){var b=document,c=b.getElementsByTagName("script")[0],b=b.createElement("script");b.type="text/javascript";b.async=!0;b.src=a;c.parentNode.insertBefore(b,c)},1)}_kms("https://i.kissmetrics.com/i.js");_kms("https://doug1izaerwt3.cloudfront.net/"+_kmk+".1.js");
var network_connection_status=!1,notification_no_network_connection,notification_general_error_global,contacts=[],which_phone_num_for_notif="000000",apiVersion=5,baseUrl="https://textyserver.appspot.com",textyStaticServerURL="http://textyapp.com",sendUrl=baseUrl+"/send?ver="+apiVersion,signInUrl=baseUrl+"/signin?extret="+encodeURIComponent(chrome.extension.getURL("help.html"))+"%23signed_in&ver="+apiVersion,signOutUrl=baseUrl+"/signout?extret="+encodeURIComponent(chrome.extension.getURL("signed_out.html"))+
"&ver="+apiVersion,registerUrl=baseUrl+"/register?ver="+apiVersion,STATUS_SUCCESS="success",STATUS_LOGIN_REQUIRED="login_required",STATUS_DEVICE_NOT_REGISTERED="device_not_registered",STATUS_GENERAL_ERROR="general_error",BROWSER_CHANNEL_RETRY_INTERVAL_MS=1E4*(1+Math.random()-0.5),channel,socket,phone_number,globalLastKnownGoogleUserName="none";
function _9d801ccbf044e557586fbb4120f6ac7baf1ae40dd6d5ad34b181d698ba5c64a37638bce9a96b18cf(a){a?chrome.browserAction.setIcon({path:"img/mt_new_19x19.png"}):chrome.browserAction.setIcon({path:"img/icon-19-off.png"})}var NEW_COUNT_GLOBAL_NOTIF=0;
function _710be66f9f3d8a441437c877bb92dd3d15e3b3a640a7034144c51d8d46ff7c0247fa36a45642e09d(){_gaq.push(["_trackEvent","CRX-Background","Error","getUserInfo-CRX-GU72",1]);_kmq.push(["identify","unknown"]);var a=NEW_COUNT_GLOBAL_NOTIF;10<NEW_COUNT_GLOBAL_NOTIF&&(a="10plus");_kmq.push(["record","Error "+a+" CRX GetUserInfo "]);console.log("----------------");NEW_COUNT_GLOBAL_NOTIF++;2>NEW_COUNT_GLOBAL_NOTIF&&(a=window.webkitNotifications.createNotification("error_icon.png","MightyText System issues",
"MightyText is having system issues. We're aware of the problem and working on it. We are sorry for the inconvenience.(Error Code: CRX-GU72)"),a.ondisplay=function(a){setTimeout(function(){a.currentTarget.cancel()},1E4)},a.show())}
function _4873caf6a405be67fe1097b79000491a0a62667d2b8d5e556f0c79930c3e96823d66ff3dd6a9bc06(){_gaq.push(["_trackEvent","CRX-Background","Error","getDistinctHeaders-CRX-GTHRD59",1]);_kmq.push(["record","Error CRX GetDistinctHeaders"]);console.log("----------------");if(1>NEW_COUNT_GLOBAL_NOTIF){var a=window.webkitNotifications.createNotification("error_icon.png","MightyText System issues","MightyText is having system issues. We're aware of the problem and working on it. We are sorry for the inconvenience. (Error Code: CRX-GTHRD59)");
a.ondisplay=function(a){setTimeout(function(){a.currentTarget.cancel()},1E4)};a.show()}}
function _f4da6f4ae4359cd59f70776edf3500bb5782b737f157b1011d9fed3d73348ae4962471c017c95dfb(){_gaq.push(["_trackEvent","Background","CAPI-Experiment-On",google_username_currently_logged_in,1]);capi_rollout_factor=2.8;_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("CAPI RolloutFactor in experiment is: "+capi_rollout_factor);clearInterval(currentGlobalIntervalID);poll_freq*=capi_rollout_factor;currentGlobalIntervalID=window.setInterval(function(){_7432e47fa118031fc8c9c4e60c8fa5da4c236186c833ec213b96322519399431368e7b899716d665()},
poll_freq);console.log("poll_freq after capi check is "+poll_freq)}
function _64a75910a26853852fd02b82a173fd0c7c25bab8ba7cf3b462401f7a89ea76d953276bc52f5622c0(a,b,c,d){var e=new XMLHttpRequest;phone_number=dest_num;e.open("POST",sendUrl,!0);e.setRequestHeader("Content-Type","application/x-www-form-urlencoded");e.setRequestHeader("X-Same-Domain","true");e.onreadystatechange=function(){if(4==this.readyState)if(200==e.status){var a=e.responseText;0==a.indexOf("OK")?d(STATUS_SUCCESS,c,e):0==a.indexOf("LOGIN_REQUIRED")?d(STATUS_LOGIN_REQUIRED,c,e):0==a.indexOf("DEVICE_NOT_REGISTERED")&&
d(STATUS_DEVICE_NOT_REGISTERED,c,e)}else d(STATUS_GENERAL_ERROR,c,e)};if("send_sms"==a)var f="phone="+encodeURIComponent(phone_number)+"&deviceType=ac2dm&action=send_sms&action_data="+encodeURIComponent(b);else"mark_single_message_read"==a?(f="deviceType=ac2dm&action=mark_single_message_read&action_data="+encodeURIComponent(b),console.log(f)):"mark_whole_thread_read"==a&&(f="deviceType=ac2dm&action=mark_whole_thread_read&action_data="+encodeURIComponent(b));e.send(f)}
function _07867623c5ac7a0579c8655f5714da543c8e258bb7eb6c689c037217079766fdb77c3bac3e51cb4c(a,b){var c=new XMLHttpRequest;phone_number=dest_num;c.open("POST",sendUrl,!0);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.setRequestHeader("X-Same-Domain","true");c.onreadystatechange=function(){if(4==this.readyState)if(200==c.status){var b=c.responseText;console.log("for C2DM call: "+a+"..... response received: "+b);0==b.indexOf("OK")?console.log(STATUS_SUCCESS):0==b.indexOf("LOGIN_REQUIRED")?
console.log(STATUS_LOGIN_REQUIRED):0==b.indexOf("DEVICE_NOT_REGISTERED")&&console.log(STATUS_DEVICE_NOT_REGISTERED)}else console.log(STATUS_GENERAL_ERROR)};if("send_sms"==a)var d="phone="+encodeURIComponent(phone_number)+"&deviceType=ac2dm&action=send_sms&action_data="+encodeURIComponent(b);else"mark_single_message_read"==a?(d="deviceType=ac2dm&action=mark_single_message_read&action_data="+encodeURIComponent(b),console.log(d)):"mark_whole_thread_read"==a&&(d="deviceType=ac2dm&action=mark_whole_thread_read&action_data="+
encodeURIComponent(b));c.send(d)}function _81720b4469b12875110e8f90d18ee16e6c0794c0f62b30ace9d03e44b746a44c0aff0ca7740bda77(a){$.ajax({type:"GET",url:"https://accounts.google.com/latitude/mobile_phone-16.gif",cache:!1,success:function(){a()}})}
function _a1d41efe36109a1f60cd75c09a94740ea3707438e45b3d89a09ec341475f9f4811d73d7f035832ba(a){a||(a=1);_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Entering function CheckGoogleLoginTokenAndSetUserName");$().ajaxError(function(a,b,e){_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("AJAX error calling URL: "+e.url+"... Reponse is: "+b.responseText);-1<e.url.search("getUserInfoFull")&&-1<b.responseText.search("500 Server Error")&&
(_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Texty trying to get Full User Auth info for this user (GetUserInfoFull)...and got Error Code 500 - likely case 1 is they are not set up Beta..."),a='<img  align=BOTTOM src="error_icon.png" width=20 height=18 /> <span style="color:black;font-size:12px"> This Google user is not registered for MightyText. Make sure you have completed the full signup process on the MightyText Android App and were invited to the beta.</span>  <a href="#" onclick="window.close();chrome.tabs.create({url: \''+
signOutUrl+'\'})"> Sign out now</a>, or <a href="#" onclick="window.close();chrome.tabs.create({url:\'http://mightytext.net/beta\'})"> Sign up for the beta</a>',window.localStorage.userRegistrationStatus=-1,document.getElementById("top-notif-bar").innerHTML=a);-1<b.responseText.search("500 Server Error")&&(_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Texty trying to get Full User Auth info for this user (GetUserInfoFull)...and got Error Code 500 - likely case 2 is they are not set up Beta..."),
a='<img  align=BOTTOM src="error_icon.png" width=20 height=18 /> <span style="color:black;font-size:12px"> This Google user is not registered for MightyText. Make sure you have completed the full signup process on the MightyText Android App and were invited to the beta.</span>  <a href="#" onclick="window.close();chrome.tabs.create({url: \''+signOutUrl+'\'})"> Sign out now</a>, or <a href="#" onclick="window.close();chrome.tabs.create({url:\'http://mightytext.net/beta\'})"> Sign up for the beta</a>',
document.getElementById("top-notif-bar").innerHTML=a)});$.ajaxSetup({error:function(a,b){console.error(a);console.error(b);if(0==a.status)console.error("*** AJAX REQUEST FAIL -- NETWORK CONNECTION PROBLEM? ***"),_9d801ccbf044e557586fbb4120f6ac7baf1ae40dd6d5ad34b181d698ba5c64a37638bce9a96b18cf(!1),num_consecutive_internet_connection_failures+=1,_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Number of consecutive internet connection failures: "+num_consecutive_internet_connection_failures),
1==num_consecutive_internet_connection_failures&&(network_connection_status=!1);else if(404==a.status)_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Error 404. Requested URL not found."),document.getElementById("msg").innerHTML="Error 404. Requested URL not found. Showing Local Messages only.";else if(500==a.status){extra_login_status_info="USER_NOT_REG_BETA";_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Error: 500 - Texty trying to get Full User Auth info for this user (GetUserInfoFull)...and got Error Code 500 - likely case 3 is they are not set up Beta...");
var e='<img  align=BOTTOM src="error_icon.png" width=20 height=18 /> <span style="color:black;font-size:14px"> This user is not registered for MightyText. Make sure you have been invited (by e-mail) to the private beta,  and have completed the full signup process on the MightyText Android App.</span>  <a href="#" onclick="window.close();chrome.tabs.create({url: \''+signOutUrl+'\'})"> Sign out now</a>, or <a href="#" onclick="window.close();chrome.tabs.create({url:\'http://mightytext.net/beta\'})"> Sign up for the beta</a>';
document.getElementById("top-notif-bar").innerHTML=e}else"parsererror"==b?(_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Error. Parsing JSON Request failed."),console.log(b),console.log(a)):"timeout"==b?_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Request Time out."):_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Unknown Error:"+a.status);_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Response text returned from server is: "+
a.responseText)}});var b=baseUrl+"/api?function=getUserInfoFull&CLIENT=CRX";_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Inside checkGoogleLoginToken function");$.ajax({url:b,global:!1,type:"GET",timeout:1E4,dataType:"jsonp",jsonpCallback:"getTheUserInfoProfile",error:function(c,b,e){console.log("ERROR in AJAX in getUserInfoFull: "+e);1==a?window.setTimeout(function(){_a1d41efe36109a1f60cd75c09a94740ea3707438e45b3d89a09ec341475f9f4811d73d7f035832ba(999)},8E3):
999==a&&(console.log("retry attempt 999 (sentinel val)"),_81720b4469b12875110e8f90d18ee16e6c0794c0f62b30ace9d03e44b746a44c0aff0ca7740bda77(_710be66f9f3d8a441437c877bb92dd3d15e3b3a640a7034144c51d8d46ff7c0247fa36a45642e09d))},success:function(a){console.log(a);network_connection_status=!0;time_last_success_mighty_ping=new Date;_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Response from Google Login Token check: "+a);if(a.user&&-1<a.user.search("user not logged in")){if(console.error("No Google Account user logged in."),_9d801ccbf044e557586fbb4120f6ac7baf1ae40dd6d5ad34b181d698ba5c64a37638bce9a96b18cf(!1),login_and_beta_ready=google_login_status=!1,extra_login_status_info=google_username_currently_logged_in="",console.log("url is "+signInUrl),console.log(chrome.extension.getURL("error_icon.png")),0==total_aggregate_polls||80==total_aggregate_polls||150==total_aggregate_polls)a=window.webkitNotifications.createNotification("error_icon.png","MightyText - Not Signed In",
" You won't be able to send/receive messages. Click here to sign in."),a.ondisplay=function(a){setTimeout(function(){a.currentTarget.cancel()},8E3)},a.onclick=function(){window.open(signInUrl);this.cancel()},a.show(),total_aggregate_polls++}else if(a.user_info_full&&0<a.user_info_full.email.length){var b=jQuery.parseJSON(a);google_username_currently_logged_in=a.user_info_full.email;window.localStorage.lastKnownGoogleUserName=a.user_info_full.email;_kmq.push(["identify",google_username_currently_logged_in]);
_kmq.push(["record","User Logged In",{"CRX-Login":"true",Client:"CRX"}]);if(void 0!=a.user_info_full.channelapi_enabled&&100==a.user_info_full.channelapi_enabled){_5bece8ddecdb642edb403ed73cfa4acf0c603e41691bd1ac7f7f30420153788b2d1ecfd7dc29f3bd();_e94efaa4c6f2a40a4c74a1f3d86eca45cacc97abda74c3f2fd3bce398f8f87fdf8b781a34ae5e0bb("REG-OK");clearInterval(currentGlobalIntervalID);console.log("User is NOT a legacy extension user - so no more polling whatsoever!");_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("!!!!!!!! ChannelAPI enabled flag (used for webapp beta testing flag) is : "+
a.user_info_full.channelapi_enabled);google_login_status=!0;login_and_beta_ready=!1;google_username_currently_logged_in=a.user_info_full.email;extra_login_status_info="WEBAPP_BETA";username_prefix_jstrg_purpose=a.user_info_full.email.substr(0,a.user_info_full.email.indexOf("@"));_gaq.push(["_trackEvent","Background","CRX-Startup-WEBAPP","",1]);console.log("******** calling webapp code");clearInterval(globalHeartbeatInterval);globalHeartbeatInterval=setInterval(_f008c217021a4661eeb5f75deb71c5c14a2b69c95a164b8d4c08974dacaa8f43335219c1975c41d5,
1E4);_b6bf3de2c89ee8581b28c646b135df7dd7a76cbf3ab7720fb63cc386e25f96a8e2e3856052cb18c2();_cba2481c250b44ed0562381741036cd9d5ead867b7d5fc0530764c5f02600052c6902571fd0c51ce(google_username_currently_logged_in,a);capi_rollout_factor=4.5;return}_e94efaa4c6f2a40a4c74a1f3d86eca45cacc97abda74c3f2fd3bce398f8f87fdf8b781a34ae5e0bb("Legacy-CRX-User");console.log("********* LEGACY CRX USER *********");_gaq.push(["_trackEvent","Background","CRX-Startup-LEGACY","",1]);_3519cdf5e9d4bef92c8881e303897f7c70d92398e0f34ffa3c10d2940937a2d499db16c5e72f5d58();
_9d801ccbf044e557586fbb4120f6ac7baf1ae40dd6d5ad34b181d698ba5c64a37638bce9a96b18cf(!0);login_and_beta_ready=google_login_status=!0;extra_login_status_info="";console.log("Google Username Logged in: "+google_username_currently_logged_in);console.log("User is logged in -- now check if they have an active device registration....");console.log("Checking current_app_version -- which is the last android app version they have installed.");document.getElementById("sign-in-status").innerHTML+='<img src="green-dot-icon.png"><span style="color:black;font-size:13px"><B> '+
google_username_currently_logged_in+"</B> | </span>";$("#sign-in-status").removeClass();_e5b8429b107481b36d0463baf17bf340d9e2a258d034fd017ea37d0d4213ba001fc333fc70f1e138();console.log(a.user_info_full);if(void 0!=a.user_info_full.app_registration_time&&(0<a.user_info_full.app_registration_time.length||0<a.user_info_full.current_app_version.length))_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("This user DOES have an active Android App registration."),_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Last known Android App version is: "+
b.user_info_full.current_app_version),_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("App Registration Time (when wizard was completed) is: "+b.user_info_full.app_registration_time),_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("-------------------------------------------------------------------------"),_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("-------------------------------------------------------------------------");
window.localStorage.usingWebAppNew=0}else-1!=a.user_status.search("not registered")?(_e94efaa4c6f2a40a4c74a1f3d86eca45cacc97abda74c3f2fd3bce398f8f87fdf8b781a34ae5e0bb("NOT-REG"),google_login_status=!0,login_and_beta_ready=!1,google_username_currently_logged_in="",extra_login_status_info="USER_REG_BUT_NO_ACTIVE_ANDROID_REG",_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("This user does not have an active Android App registration! (either never set up or they disconnected..)"),
notify_android_app_install_once||(a=webkitNotifications.createNotification("error_icon.png","MightyText - Install Android App ","It looks like you haven't installed the MightyText Android app. You'll need to first install it on your Android phone using Google Play, and select this same Google account ("+a.email+")"),capi_rollout_factor=7,a.show(),notify_android_app_install_once=!0)):(console.log(a.user_status.search("not reg")),notification_general_error_global=webkitNotifications.createNotification("error_icon.png",
"MightyText","General Error. Please contact the MightyText team."),notification_general_error_global.show());_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Google Login Status - based on OPENID token from Google: "+google_login_status+" / username is: "+google_username_currently_logged_in)}})}(function(a){a.getScriptCacheTrueOverrideCustom=function(b,c){a.ajax({type:"GET",url:b,success:c,dataType:"jsonp",cache:!0})}})(jQuery);
function _e94efaa4c6f2a40a4c74a1f3d86eca45cacc97abda74c3f2fd3bce398f8f87fdf8b781a34ae5e0bb(a){_kmq.push(["record","CRX-UserState-"+a])}function _e77f265234fb99786ae4697aafd198181ef8899fdecf6d1228c5c89ece1ca9de73c1619e10a7ab8a(a){var b=document.getElementsByTagName("head")[0],c=document.createElement("script");c.type="text/javascript";c.onload=_cba2481c250b44ed0562381741036cd9d5ead867b7d5fc0530764c5f02600052c6902571fd0c51ce;c.src=a;b.appendChild(c)}
function _6c379bb106f6fdd86e960dd460cbb90f5534532aae894a77d383b8377c090b8fe01ed4197ec10d97(){should_get_contacts_token_in_new_tab=!1;window.setTimeout(function(){_b4a3df8bbcac42b62ab5f56de43c69fc522dbc887e3b1e0f406e11c600ced009d8a357fc5aa57da8()},10)}
function _c302c006f66c9b1240b45741fe0b99acb1789f3926cfd58808847e0440c0457dc33206c2ff8cb510(a){var b=baseUrl+"/getJson?function=GetMessage";$.ajaxSetup({error:function(a,b){if(0==a.status){if(num_consecutive_internet_connection_failures+=1,_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Number of consecutive internet connection failures: "+num_consecutive_internet_connection_failures),3==num_consecutive_internet_connection_failures||15==num_consecutive_internet_connection_failures)network_connection_status=
!1,_9d801ccbf044e557586fbb4120f6ac7baf1ae40dd6d5ad34b181d698ba5c64a37638bce9a96b18cf(!1)}else 404==a.status?(_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Error 404. Requested URL not found."),document.getElementById("msg").innerHTML="Error 404. Requested URL not found."):500==a.status?(_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Error 500. Internal Server Error."),document.getElementById("msg").innerHTML="Error 500. Internal Server Error."):
"parsererror"==b?_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Error. Parsing JSON Request failed."):"timeout"==b?_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Request Time out."):_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Unknown Error");_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Response text returned from server is: "+a.responseText)}});$.get(b,
{},function(b){network_connection_status=!0;time_last_success_mighty_ping=new Date;num_consecutive_internet_connection_failures=0;_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("JSON Raw text response from GetMessage function is: "+b);if(0<b.search("not logged in"))_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("User NOT logged in to MightyText"),a&&(google_login_status=!1,google_username_currently_logged_in="");else if('{"messages":}'==
b)console.log("BLANK - no messages");else if(0<b.length){_9d801ccbf044e557586fbb4120f6ac7baf1ae40dd6d5ad34b181d698ba5c64a37638bce9a96b18cf(!0);var d=JSON.parse(b),e=0,f=0,i=0,f=b.split('"type":"0","source":"0"').length-1;console.log("*** Number of Inbox (incoming msgs), based on string match splits is: "+f);var j=!1,b=!1;6<f&&(j=!0,_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("TOO Many messages retrieved in JSON - so don't show any notifs. Total num messages retrieved (incoming only: "+
f),b=!0);$.each(d.messages,function(b,c){var d=c.orig_address,f="",g="";for(a&&_24b155fee6fbc306a626390e3c06560a7a7c7900aec39f8e95a69ee981718b192cf881d00c4f9f12("Found at least 1 Message or ACK/etc, decrease polling frequency",9E3);-1<d.search("[-]");)d=d.replace("-","");-1==d.search("[+]")&&(g="1"==d.charAt(0)?"+":"+1");OLD_phonenum_normalized=g+d;f=c.orig_address;_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("found message to sync... "+f+": "+c.body);0==c.status&&
2==c.source?(_c14b65cf11330037616cd9e3db1b0e714ae9880758bd42d858f3b3626aa142be7da0793226cdc391(c.email,c.body,f,c.android_uid),e++):db.transaction(function(b){b.executeSql("INSERT INTO Messages (googleusername,msgid,time_client,time_server,from_phone_num,body,type,status,source) VALUES (?,?,?,?,?,?,?,?,?)",[c.email,c.android_uid,_a877160a75c844226a4fe42ff88c2a1e78edc290c1086ca5d2c1317aae27e13f2569440783c14257(c.ts),_a877160a75c844226a4fe42ff88c2a1e78edc290c1086ca5d2c1317aae27e13f2569440783c14257(c.ts_server),
f,c.body,c.type,c.status,c.source],function(){_19d608a5ebedf6c43c1172e38b2f0185af8b88ae9e3bc76a358384b26447ed1323aa25dc8b8a0e4c(c.android_uid);var b=!1;(0==c.type||81==c.type||80==c.type)&&!1==j?(_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("called from BG page and MsgType=0, and not too many messages, so popping single notif now"),b=!0,which_phone_num_for_notif=f):(_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("MsgType=1 (sync sent SMS from phone), so don't pop notif"),
i++);if(a){var d=new Date(c.ts),e=new Date,g=e.getTime()-d.getTime(),h=1;81==c.type?h=0.1:80==c.type&&(h=0.005);g>36E5*h&&(b=!1,_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("** Message is too old to pop Notif** - for message type: "+c.type));_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("...JS date is "+d);_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("current time is"+e);_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("TIME DIFF (in ms) IS -- "+
g+"ms since msg was sent -- comparing to: "+36E5*h);b&&(b="popup_one_text_message.html#"+c.android_uid,d=webkitNotifications.createHTMLNotification(chrome.extension.getURL(b)),_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("showing notif to user...URL is: "+b),_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Notif Level Preference from Local datastore is: "+window.localStorage.notifLevel),d.ondisplay=function(){setTimeout("notification_html.cancel();",
5E3)},d.show(),msgcount="")}},function(a,b){_1f1b0ab71d1094b32f80a4658347be63939f761f2e8ba07a3d228e38028339db0131b8b29f0907da(a,b,c.android_uid)})})});b&&(_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("showing GENERIC (too many messages) notif to user..."),b=webkitNotifications.createNotification("",f+" Text Messages","You've received "+f+" text messages since the last time you used MightyText, so we won't show you each popup for these messages."),_gaq.push(["_trackEvent",
"Background","Lots-Of-Incoming-Messages-Trigger-Popup","TOO-MANY-NOTIF-"+google_username_currently_logged_in,f]),b.show());_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("msg_count_ack is "+e);_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("msg_count_incoming is "+f);_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("msg_count_outgoing_sync_from_phone is "+i);d=d.messages.length;_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Num messages pulled from this JSON feed is: "+
d);0<d&&(f="",f=a?"Background":"Popup",1<d?_gaq.push(["_trackEvent",f,"Got-Messages-SMS","Got-Multiple-Messages",d]):_gaq.push(["_trackEvent",f,"Got-Messages-SMS","Got-1-Message",d]))}})}
function _c14b65cf11330037616cd9e3db1b0e714ae9880758bd42d858f3b3626aa142be7da0793226cdc391(a,b,c,d){_gaq.push(["_trackEvent","Background","Got-Message-ACK","",1]);_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Reconciling SMS where originally sent from chrome...");db.transaction(function(e){_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("UPDATE Messages SET status=52 WHERE googleusername="+a+"and body="+b+" and from_phone_num="+
c+"  and status=51");e.executeSql("UPDATE Messages SET status=52 WHERE googleusername=? and body=? and from_phone_num=? and status=51",[a,b,c],function(){_19d608a5ebedf6c43c1172e38b2f0185af8b88ae9e3bc76a358384b26447ed1323aa25dc8b8a0e4c(d)},_39ddea6aa3ff0c82f010975424b25bb0b658b83b4ce97040cc6d94438fa8dd736cf752254995ef96)})}
function _1f1b0ab71d1094b32f80a4658347be63939f761f2e8ba07a3d228e38028339db0131b8b29f0907da(a,b,c){_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("SQL insert error: "+b.message);-1<b.message.search("constraint failed")&&(_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("because it IS a constraint message, we will now RETRY to delete message on server, with android_uid "+c+" from the Cloud Server"),_19d608a5ebedf6c43c1172e38b2f0185af8b88ae9e3bc76a358384b26447ed1323aa25dc8b8a0e4c(c))}
function _19d608a5ebedf6c43c1172e38b2f0185af8b88ae9e3bc76a358384b26447ed1323aa25dc8b8a0e4c(a){var b=baseUrl+"/getJson?function=DeleteMessages&android_uid="+a;_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Attempting to delete from cloud server this android_uid:"+a);$.ajax({type:"GET",url:b,success:function(a){_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Response from cloud after delete attempt: "+a)},error:function(){console.log("error in deletemessagefrom server")}})}
var globalWidgetNotifTester;function _392a201f2e5f8ec34dc9ba19119119d8357e62026632e7ca34bf65b81cadd060000fa794dc91938f(){globalWidgetNotifTester=webkitNotifications.createHTMLNotification("mighty-widget.html");globalWidgetNotifTester.show()}
function _001eecf574be8e81bbec314c613454c697c9788a890ced7ecc60da9247091c50325fc8c89708a622(){_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Getting channel API token...");$.ajax({type:"GET",url:baseUrl+"/getJson?function=getChannelToken&mins=240",success:function(a){console.log("Response from cloud after channel attempt (should have valid_token prepend): "+a);if(0>a.search("valid_token:"))console.log("No valid_token prepend found from Channel API!");else{time_last_channel_token_obtained=
new Date;console.log("Resetting Last Channel ATTEMPT TO OBTAIN Token time . . .");var a=a.replace("valid_token:",""),b=(new goog.appengine.Channel(a)).open();console.log("calling channel.open");b.onopen=function(){console.log("Socket Opened via Channel API with token: "+a);_gaq.push(["_trackEvent","Background","ChannelAPI-Open-Socket","",1])};b.onmessage=function(a){_43a736b3e9532bc2ec3d7b68d4961fdc2f7c3c1ecf2d42439afa3488174fffa6a4d30c205a094150();_gaq.push(["_trackEvent","Background","ChannelAPI-Message-Received",
"",1]);console.log("**** CHANNEL SOCKET ONMESSAGE *** Force a poll... ");console.log("Message arrived via channel API= "+a.data)};b.onerror=function(){console.log("!!!!!!!!!!!!! TOKEN GONE (via onerror callback)!!!!!!!!!!!!");_gaq.push(["_trackEvent","Background","ChannelAPI-Socket-ONERROR-Token-Expired","",1]);_001eecf574be8e81bbec314c613454c697c9788a890ced7ecc60da9247091c50325fc8c89708a622()};b.onclose=function(){console.log("!!!!!!!!!!!!! TOKEN GONE (via onclose callback) !!!!!!!!!!!!");_gaq.push(["_trackEvent",
"Background","ChannelAPI-Socket-ONCLOSE","",1])}}}})}function _670be9964184fad45a542374a24be3505e953bf57b1a65ed3b6d0acc6e6e7dc87eca54cd20023067(a){webkitNotifications.createNotification("",Date(),a).show()}
function _f28fbaf14e7f2a9040058122cc5e43ba2c64813f97fb9bacf141dd36d301425657b6cefad40115e9(){var a="popup_one_text_message.html#"+thismessage.android_uid,b=webkitNotifications.createHTMLNotification(chrome.extension.getURL(a));_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("showing notif to user...URL is: "+a);_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Notif Level Preference from Local datastore is: "+window.localStorage.notifLevel);
b.show()}function _6298bd7d9d87d3359058844401d0061c6f64f68a205e123cd0ad6c76344e88c1f36c22cd1528fa67(a){chrome.windows.create({url:a,left:10,top:10,width:810,height:610,type:"popup"},function(){})}
function _a877160a75c844226a4fe42ff88c2a1e78edc290c1086ca5d2c1317aae27e13f2569440783c14257(a){var b=new Date(a),a=b.getHours(),c=b.getSeconds(),d=b.getMinutes(),e=b.getDate(),f=b.getMonth(),b=b.getFullYear();f++;10>f&&(f="0"+f);10>e&&(e="0"+e);10>a&&(a="0"+a);10>d&&(d="0"+d);10>c&&(c="0"+c);return b+"-"+f+"-"+e+" "+a+":"+d+":"+c}var should_get_contacts_token_in_new_tab=!1;
function _b4a3df8bbcac42b62ab5f56de43c69fc522dbc887e3b1e0f406e11c600ced009d8a357fc5aa57da8(){oauth.authorize(function(){_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("on google contacts - oauth.authorize()");oauth.sendSignedRequest("http://www.google.com/m8/feeds/contacts/default/full",_eb37f38824bc114a1b286095ed313ce54faa0bbb5ec475005d2a5e68419080231b038c154aefaeed,{parameters:{alt:"json","max-results":1E4}})})}
function _bbf0840f485d7b40f83937a48017da9338e2f4fad79dfd7857cc923493f1d7e34186cf7e04ec9d41(){oauth.clearTokens()}function _8c7d84cfb4634dc279cb2c81e9a85f5a8cb297218fba286e8844986191ff9dbf8c12531d0f305080(){window.localStorage.notifLevel=3}
function _9c477210d23ffe19a98e84cd79e7804fe7e02b5e7966f05d5ba5bdccbdf07eb0c2d946d9affcc6ad(){db||(db=openDatabase("Texty","1.0","Texty-SMS",2E5));db.transaction(function(a){a.executeSql("SELECT COUNT(*) as cnt FROM sqlite_master where name='Messages'",[],function(a,c){var d=c.rows.item(0).cnt;_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Messages table exists?: "+d);0==d&&(_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Couldnt find table LocalGoogleContacts...creating..."),
_8561a15c432fd3e94c4e6b66d17af1a2a117dba0d1ce44a51fad2e78c05839a4db24247ddac5436d())},_39ddea6aa3ff0c82f010975424b25bb0b658b83b4ce97040cc6d94438fa8dd736cf752254995ef96)});db.transaction(function(a){a.executeSql("SELECT COUNT(*) as cnt FROM sqlite_master where name='LocalGoogleContacts'",[],function(a,c){var d=c.rows.item(0).cnt;_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("LocalGoogleContacts table exists?: "+d);0==d&&(_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Couldnt find table LocalGoogleContacts...creating..."),
_8f8b852adda559ff7511c733ad984f7220dec1d4c512371affdf27de97c303b331e92259646f2c5c())},_39ddea6aa3ff0c82f010975424b25bb0b658b83b4ce97040cc6d94438fa8dd736cf752254995ef96)})}
function _8561a15c432fd3e94c4e6b66d17af1a2a117dba0d1ce44a51fad2e78c05839a4db24247ddac5436d(){db.transaction(function(a){a.executeSql("CREATE TABLE Messages (id INTEGER PRIMARY KEY AUTOINCREMENT, googleusername TEXT, msgid TEXT UNIQUE, time_client DATE, time_server DATE, from_phone_num TEXT, body TEXT, type INTEGER, status INTEGER, source INTEGER)",[],function(){_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("table Messages created")},_39ddea6aa3ff0c82f010975424b25bb0b658b83b4ce97040cc6d94438fa8dd736cf752254995ef96)})}
function _8f8b852adda559ff7511c733ad984f7220dec1d4c512371affdf27de97c303b331e92259646f2c5c(){db.transaction(function(a){a.executeSql("CREATE TABLE LocalGoogleContacts (id INTEGER PRIMARY KEY AUTOINCREMENT, googleusername TEXT, phone_num TEXT UNIQUE, contact_name TEXT)",[],function(){_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("table LocalGoogleContacts created")},_39ddea6aa3ff0c82f010975424b25bb0b658b83b4ce97040cc6d94438fa8dd736cf752254995ef96)})}
function _e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02(a){1==debug_mode&&console.log(a)}
function _0ca5b21d85462c6c6cb59487ed616a007653a9df5681b6a7ffc8ecaced0f9fe420825d4156654da8(a,b){for(var c=0;c<contacts.length;c++){var d=_824922b5bbf98dcc9c9462797b2fba269ee76417d23d9814e051bed122369f0751f122f662989a96(contacts[c].phonenums[0]).search(a);if(-1<d)return _e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("FOUND substring in Google Contact Array- substring match position is: "+d),_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Inserting this contact into Local Contact DB table...full phone num is "+
b+"..."+contacts[c].name),_bedebe796eeeccf177110f385f377eafb3354985d574c24b623c1073a5b9a332b77a7ca39d4f4df4(contacts[c].phonenums[0],contacts[c].name),{contactPhoneNumberfromGoogleContactsArray:b,contactNamefromGoogleContactsArray:contacts[c].name}}return""}
function _b466910b68e33c11afa3db9adcafe49faef40b02d1bdeb5e0f97f822a25c14aa56041743ae58b6b9(a){for(var b=0;b<localContactsArray.length;b++){var c=_824922b5bbf98dcc9c9462797b2fba269ee76417d23d9814e051bed122369f0751f122f662989a96(localContactsArray[b].phone_num).search(a);if(-1<c)return _e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("FOUND substring in local contact - substring match position is: "+c),{contactPhoneNumberLocalDB:localContactsArray[b].phone_num,contactNameLocalDB:localContactsArray[b].contact_name}}return""}
function _824922b5bbf98dcc9c9462797b2fba269ee76417d23d9814e051bed122369f0751f122f662989a96(a){for(;-1<a.search("[-]");)a=a.replace("-","");for(;-1<a.search("[ ]");)a=a.replace(" ","");for(;-1<a.search("[(]");)a=a.replace("(","");for(;-1<a.search("[)]");)a=a.replace(")","");7>a.length&&(a=_e5060d2c27c7281e56dbdcf304356f8db9812b78749fa825d1f9d8e78bd2495940f92586c04ef35a(a,7));return a}
function _bedebe796eeeccf177110f385f377eafb3354985d574c24b623c1073a5b9a332b77a7ca39d4f4df4(a,b){db.transaction(function(c){c.executeSql("INSERT INTO LocalGoogleContacts (googleusername,phone_num,contact_name) VALUES (?,?,?)",[google_username_currently_logged_in,a,b],function(){_e7f62bf521107bc01363b1d59ee5a985ef836b75282d8e73f252def298b4f0621a13699b78247d02("Added Contact to local SQL: "+b+" / "+a+" / "+google_username_currently_logged_in)},_39ddea6aa3ff0c82f010975424b25bb0b658b83b4ce97040cc6d94438fa8dd736cf752254995ef96)})}
function _792285c6254d6ae95dfa6d1d5848421053f2d24eacb381711c815b56ac54499f7190af8572c35b6f(){$.get("http://textyapp.com/get_dynamic_info.php",function(a){dynamic_info_global=a})}function _e5060d2c27c7281e56dbdcf304356f8db9812b78749fa825d1f9d8e78bd2495940f92586c04ef35a(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c}function _d9683102d1147e6478281ea75b3fad55442b6c783223d8e2664545fc5ddcaebf7d9b96bccdcf929f(a){return a};