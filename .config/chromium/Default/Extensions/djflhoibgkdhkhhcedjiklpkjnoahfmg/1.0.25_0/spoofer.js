var CUSTOM_OPTIONS_IDENTIFIER="custom_options_list";var BASE_OPTIONS_IDENTIFIER="base_options_list";var USE_PRESETS_IDENTIFIER="use_presets";var PRESET_LIST_IDENTIFIER="preset_list";var SPOOFER_LIST="spoofer_list";var HOTLIST_INDEX="hotlist_index";var PERMANENT_OVERRIDE="permanent_override";var update_url="http://spoofer-extension.appspot.com/update";var last_update_time=null;var req;function UserAgent(f,b,d,a,c,e){this.title=f;this.ua_string=b;this.vendor=d;this.badge=a;this.is_preset=c;this.append_to_default_ua=false;this.group=e;this.show_in_list=false;this.getUserAgentString=new function(g){if(this.append_to_default_ua){return g+" "+this.ua_string}return this.ua_string}}function PresetSpoof(b,a){this.domain=b;this.user_agent=a}function getParsedItem(b){try{return JSON.parse(localStorage.getItem(b))}catch(a){}return null}function storeItem(a,b){if(!b){b=""}localStorage.setItem(a,JSON.stringify(b))}function setShouldUsePresets(a){storeItem(USE_PRESETS_IDENTIFIER,""+a)}function shouldUsePresets(){var a=getParsedItem(USE_PRESETS_IDENTIFIER);return(!a||a=="true")}function setPermanentSpoofOverride(a){storeItem(PERMANENT_OVERRIDE,""+a)}function getPermanentSpoofOverride(){var a=getParsedItem(PERMANENT_OVERRIDE);return(a&&a=="true")}function setSpoofList(a){storeItem(SPOOFER_LIST,a)}function getOptions(){var b=new Array();var a=getCustomOptions();var d=getBaseOptionsList();b=b.concat(d).concat(a);for(var c=0;c<b.length;c++){if(b[c]){b[c].index=c}}return b}function getOptionsByGroup(){var c=getOptions();var a={};for(var b=0;b<c.length;b++){if(!c[b]){continue}var d=getUserAgentGroup(c[b]);if(!a[d]){a[d]=new Array()}a[d].push(c[b])}return a}function findHostname(c){var b=document.createElement("a");b.href=c;return b.host}function isDomainName(b){var a=new RegExp("^(https?://)?((([a-z\d]([a-z\d-]*[a-z\d])*).)+[a-z]{2,}|((\d{1,3}.){3}\d{1,3}))(:\d+)?(/[-a-z\d%_.~+]*)*$","i");return a.test(b)}function getBaseOptionsList(a){var b=(a?null:getParsedItem(BASE_OPTIONS_IDENTIFIER));if(!b){var b=new Array();b.push(new UserAgent("Default","","","",true,"Chrome"));b.push(new UserAgent("Windows Firefox 3.5","Mozilla/5.0 (Windows; U; Windows NT 6.0; en; rv:1.9.1.7) Gecko/20091221 Firefox/3.5.7","Mozilla, Inc.","FF3",true,"Firefox"));b.push(new UserAgent("Windows Firefox 4","Mozilla/5.0 (Windows NT 6.1; rv:2.0.1) Gecko/20100101 Firefox/4.0.1","Mozilla, Inc.","FF4",true,"Firefox"));b.push(new UserAgent("Windows Firefox 15","Mozilla/5.0 (Windows NT 6.1; WOW64; rv:15.0) Gecko/20120427 Firefox/15.0a1","Mozilla, Inc.","F15",true,"Firefox"));b.push(new UserAgent("Opera 10","Opera/9.80 (Macintosh; Intel Mac OS X; U; en) Presto/2.2.15 Version/10.00","Mozilla, Inc.","O10",true,"Opera"));b.push(new UserAgent("OSX Safari 5","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit/534.55.3 (KHTML, like Gecko) Version/5.1.3 Safari/534.53.10","Apple, Inc.","S5",true,"Safari"));b.push(new UserAgent("Internet Explorer 6","Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; WOW64; Trident/4.0; SLCC1)","Microsoft","IE6",true,"Internet Explorer"));b.push(new UserAgent("Internet Explorer 7","Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; WOW64; Trident/4.0; SLCC1)","Microsoft","IE7",true,"Internet Explorer"));b.push(new UserAgent("Internet Explorer 8","Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; WOW64; Trident/4.0; SLCC1)","Microsoft","IE8",true,"Internet Explorer"));b.push(new UserAgent("Internet Explorer 9","Mozilla/5.0 (MSIE 9.0; Windows NT 6.1; Trident/5.0)","Microsoft","IE9",true,"Internet Explorer"));b.push(new UserAgent("iPhone 4","Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_3_2 like Mac OS X; en-us) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8H7 Safari/6533.18.5","Apple, Inc.","IP4",true,"iOS"));b.push(new UserAgent("iPad","Mozilla/5.0 (iPad; U; CPU OS 3_2 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 Mobile/7B334b Safari/531.21.10","Apple, Inc.","iPad",true,"iOS"));b.push(new UserAgent("Android 4.1 - Nexus 7","Mozilla/5.0 (Linux; Android 4.1.1; Nexus 7 Build/JRO03D) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166  Safari/535.19","","AND",true,"Android"));b.push(new UserAgent("Windows Phone 7","Mozilla/5.0 (compatible; MSIE 9.0; Windows Phone OS 7.5; Trident/5.0; IEMobile/9.0; NOKIA; Lumia 800)","","WP7",true,"Windows Phone"));setBaseOptionsList(b)}return b}function setBaseOptionsList(a){storeItem(BASE_OPTIONS_IDENTIFIER,a)}function getCustomOptions(){var a=getParsedItem(CUSTOM_OPTIONS_IDENTIFIER);return(a?a:[])}function setCustomOptions(a){storeItem(CUSTOM_OPTIONS_IDENTIFIER,a)}function addCustomUAOption(d,c,f,b,h){var a=getCustomOptions();if(!a){a=new Array()}for(var e=0;e<a.length;e++){if(a[e].title==d){return false}}var g=new UserAgent(d,c,"",b,false,h);g.append_to_default_ua=f;a.push(g);setCustomOptions(a);return true}function deleteUAOption(b,d){var a=(d?getBaseOptionsList():getCustomOptions());if(!a){return false}for(var c=0;c<a.length;c++){if(a[c].title==b){a.splice(c,1);break}}if(d){setBaseOptionsList(a)}else{setCustomOptions(a)}return true}function isRemovable(a){return(!a.is_preset||a.ua_string!="")}function getDisplayUserAgentString(a){return(a.ua_string==""?"[Use default User-agent string]":a.ua_string)}function getDisplayAppendOrReplaceString(a){return(a.ua_string==""?"N/A":(a.append_to_default_ua?"Append":"Replace"))}function guessUserAgentGroup(c){if(!c){return""}var b=[["Chrome","Chrome"],["Firefox","Firefox"],["Opera","Opera"],["Safari","Safari"],["IE","Internet Explorer"],["Internet Explorer","Internet Explorer"],["iPhone","iPhone"],["iPad","iPad"],["iOS","iOS"]];for(var a=0;a<b.length;a++){if(c.toUpperCase().indexOf(b[a][0].toUpperCase())>-1){return b[a][1]}}return""}function getUserAgentGroup(a){if(!a){return""}if(a.group){return a.group}return""}function importUserAgentData(f){var d=0;var e=0;var a=getCustomOptions();var c={};for(var b=0;b<a.length;b++){c[a[b].ua_string]="1"}$("useragent",f).each(function(){var g=new UserAgent($(this).attr("description"),$(this).attr("useragent"),"","X",false,_getParentFolderName($(this).parent()));if(g.group!="UA List :: About"){if(c[g.ua_string]){e++}else{c[g.ua_string]="1";a.push(g);d++}}});setCustomOptions(a);return{import_count:d,duplicates:e}}function _getParentFolderName(b){var c=($(b)&&$(b).parent().length>0)?_getParentFolderName($(b).parent()):null;var a=$(b).attr("description");return(c?c+" - "+a:(a?a:null))}function getHotlistIndex(){var a=getParsedItem(HOTLIST_INDEX);if(!a){return -1}return a}function setHotlistIndex(a){var b=getOptions();if(a>-1&&a<b.length){storeItem(HOTLIST_INDEX,a)}else{console.log("Error: attempting to say hotlist index is "+a+", which isn't valid")}}function getPresets(){if(shouldUsePresets()){var a=new Date();a.setDate(a.getDate()-1);if(!last_update_time||a>last_update_time){last_update_time=new Date();_updatePresetList()}}var b=getParsedItem(PRESET_LIST_IDENTIFIER);if(b&&b.length>0){return b}else{return new Array()}}function clearPresets(){storeItem(PRESET_LIST_IDENTIFIER,"")}function _updatePresetList(){req=new XMLHttpRequest();req.open("GET",update_url,true);req.setRequestHeader("Accept","text/plain");req.onreadystatechange=function(){if(req.readyState==4){if(req.status==200||req.responseText){try{var d=JSON.parse(req.responseText);var c=new Array();if(d&&d.length>0){console.log("Update succeeded");for(var a=0;a<d.length;a++){c.push(new PresetSpoof(d[a][0],new UserAgent("title",d[a][1],d[a][2],d[a][3],false)))}}}catch(b){console.log("Update failed: "+b);console.log("response text:"+req.responseText);console.log("list:"+d)}}else{console.log("Update failed.  Will re-attempt later.")}}};req.send(null)}function getSpoofList(){var a=getParsedItem(SPOOFER_LIST);if(!a){a=new Array()}if(shouldUsePresets()){a=a.concat(getPresets())}return a}function getBadge(a){if(!a||a==""){return""}var c=getOptions();for(var b=0;b<c.length;b++){if(c[b].ua_string==a){return c[b].badge}}return""}function addOption(c,d){var b=getSpoofList();var a=getOptions();if(d<0||d>a.length){return}b.push(new PresetSpoof(c,a[d]));setSpoofList(b)}function _isApplicableMatch(b,a){if(!a){return false}var d=findHostname(a);var e=isDomainName(b);var c=new RegExp(b);return((!e&&c.test(a))||c.test(d)||b==d||b==a||(e&&d.indexOf(b)>-1))}function getHotlist(){var b=getOptions();var a=getHotlistIndex();if(!b||a<0||a>=b.length){return null}return b[a]}function setHotlist(b,a){setHotlistIndex(a)}function getSpoofValuesForUrl(a){if(!a){return null}var c=getSpoofList();for(var b=0;b<c.length;b++){if(a&&c[b]&&c[b].domain&&c[b].user_agent&&_isApplicableMatch(c[b].domain,a)){return c[b].user_agent}}return null}function getSpoofValues(b){var a=getPermanentSpoofOverride();var e=getHotlist();var d=getSpoofValuesForUrl(b);var c=(a?(d?d:e):(e?e:d));if(!c){return{}}c.platform=getPlatformSpoofValues(c);c.appname=getAppnameSpoofValues(c);return c}function getPlatformSpoofValues(a){if(a&&a.ua_string&&a.ua_string.indexOf("Macintosh")>-1){return"MacIntel"}return null}function getAppnameSpoofValues(a){if(a&&a.ua_string&&a.ua_string.indexOf("MSIE")>-1){return"Microsoft Internet Explorer"}return null};